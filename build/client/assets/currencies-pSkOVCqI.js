import{s as P,_ as q}from"./vue-layout.vue_vue_type_script_setup_true_lang-Dd9kIAe8.js";import{s as T,a as O}from"./index-DXvl-esB.js";import{d as E,Y as M,a1 as Y,b as N,r as F,q as a,s as L,v as o,o as _,h as B,j as J,a as s,D as G,w as b,e as R,bB as X,p as w,x as S,c as U,N as Z}from"./main-CE88ee4Q.js";import{u as k,$ as H}from"./use-fetch-CNl_4VEC.js";import{_ as K}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-U_TlgEzX.js";import{_ as Q}from"./VNavbar.vue_vue_type_script_setup_true_lang-GcHfqelS.js";import{s as ee}from"./index-B9cPqbKC.js";import{s as te}from"./index-DHTAa8Us.js";import{s as se}from"./index-Drofbpnb.js";import{_ as ae}from"./VFileUploader.vue_vue_type_script_setup_true_lang-DHTQRJoi.js";import{u as le}from"./use-swrv-ttgJgnvy.js";import"./index-BGiSEDGv.js";import"./index-wutX35Rh.js";import"./index-BPNPmUFq.js";import"./index-B88Wmsvc.js";const re=E({__name:"currency-deleter",props:{id:{}},emits:["delete"],setup(p,{emit:h}){const g=h,r=M(),d=Y(),{isFetching:t,error:f,data:x,execute:u}=k(()=>`/api/admins/me/currencies/${p.id}`,{immediate:!1}).delete().json(),c=async()=>{if(await u(),f.value||!x.value){r.add({severity:"error",summary:"Error",detail:f.value.message,life:6e3});return}r.add({severity:"success",summary:"Success",detail:"Currency deleted",life:3e3}),g("delete",p.id)},i=()=>{d.require({message:"Are you sure you want to proceed?",header:"Delete Currency",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Delete",severity:"danger"},accept:()=>{c()}})};return(m,C)=>{const V=L;return _(),N("div",null,[F(m.$slots,"default",{},()=>[a(V,{onClick:i,loading:o(t),icon:"pi pi-trash",severity:"danger",size:"small",rounded:"",outlined:""},null,8,["loading"])])])}}}),oe={class:"grid gap-4"},ne={class:"flex flex-col items-center justify-center gap-1"},ie={class:"w-20 aspect-square overflow-hidden rounded-full"},ue=["src"],de={class:"grid"},ce={class:"grid"},me={class:"grid"},ve={class:"grid"},pe={class:"text-mute"},fe={class:"grid"},ye={class:"grid"},ge={class:"grid"},be={key:0,class:"grid"},we={class:"grid mt-3"},_e=E({__name:"currency-manager",props:{currency:{},buttonLabel:{},buttonIcon:{default:"pi pi-pencil"},rounded:{type:Boolean}},emits:["done"],setup(p,{emit:h}){const g=h,r=B(!1),d=M(),t=B(p.currency?JSON.parse(JSON.stringify(p.currency)):{}),{isFetching:f,error:x,data:u,execute:c}=k("/api/admins/me/currencies",{immediate:!1}).post(t).json(),{isFetching:i,error:m,data:C,execute:V}=k(()=>{var n;return`/api/admins/me/currencies/${(n=p.currency)==null?void 0:n.id}`},{immediate:!1}).put(t).json(),y=async()=>{if(p.currency){if(t.value.rate!==p.currency.rate&&(t.value.rateUpdatedAt=new Date),t.value=Object.fromEntries(Object.entries(t.value).filter(([,n])=>n!==null)),await V(),m.value||!C.value){d.add({severity:"error",summary:"Error",detail:m.value.message||"Something went wrong"});return}d.add({severity:"success",summary:"Done",detail:C.value.message||"Currency updated successfully",life:3e3}),g("done",C.value.currency),r.value=!1}else{if(!t.value.image)try{const e=await(await fetch("/assets/default-crypto-icon.txt")).text();t.value.image=e}catch(n){console.error(n)}if(await c(),x.value||!u.value){d.add({severity:"error",summary:"Error",detail:x.value.message||"Something went wrong"});return}d.add({severity:"success",summary:"Done",detail:u.value.message||"Currency created successfully",life:3e3}),g("done",u.value.currency),r.value=!1}},A=J(()=>!t.value.name||!t.value.abbr||!t.value.symbol||!t.value.rate||!t.value.walletAddress||t.value.isAvailableForWithdrawal&&(t.value.withdrawalCharge===void 0||t.value.withdrawalCharge===null));return(n,e)=>{const $=L,v=P,D=se,W=te,z=ee,I=G;return _(),N("div",null,[s("div",{onClick:e[0]||(e[0]=l=>r.value=!0),class:"cursor-pointer"},[F(n.$slots,"default",{},()=>[a($,{size:"small",icon:n.buttonIcon,rounded:n.rounded,label:n.buttonLabel},null,8,["icon","rounded","label"])])]),a(I,{visible:r.value,"onUpdate:visible":e[11]||(e[11]=l=>r.value=l),modal:"",header:n.currency?"Edit Currency":"New Currency",class:"w-80 md:w-96"},{default:b(()=>[s("div",oe,[s("div",ne,[s("div",ie,[s("img",{src:t.value.image||void 0,class:"w-full h-full object-cover"},null,8,ue)]),a(ae,{size:"small",accept:"image/*","max-file-size":o(X),onSelect:e[1]||(e[1]=l=>t.value.image=l[0].dataUrl??""),onUpload:y,onCancel:e[2]||(e[2]=l=>{var j;return t.value.image=((j=n.currency)==null?void 0:j.image)??""}),class:"w-full",loading:o(f)||o(i),disabled:o(f)||o(i)||A.value},null,8,["max-file-size","loading","disabled"])]),a(v),s("div",de,[e[12]||(e[12]=s("label",{class:"text-mute text-sm font-medium"},[w(" Name "),s("span",{class:"text-red-500"},"*")],-1)),a(D,{modelValue:t.value.name,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.name=l),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),s("div",ce,[e[13]||(e[13]=s("label",{class:"text-mute text-sm font-medium"},[w(" Abbreviation "),s("span",{class:"text-red-500"},"*")],-1)),a(D,{modelValue:t.value.abbr,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.abbr=l),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),s("div",me,[e[14]||(e[14]=s("label",{class:"text-mute text-sm font-medium"},[w(" Symbol "),s("span",{class:"text-red-500"},"*")],-1)),a(D,{modelValue:t.value.symbol,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.symbol=l),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),s("div",ve,[e[15]||(e[15]=s("label",{class:"text-mute text-sm font-medium"},[w(" Exchange Rate (USD) "),s("span",{class:"text-red-500"},"*")],-1)),s("small",pe,"1 "+S(t.value.abbr)+" equals",1),a(W,{modelValue:t.value.rate,"onUpdate:modelValue":e[6]||(e[6]=l=>t.value.rate=l),prefix:"$","max-fraction-digits":10,fluid:""},null,8,["modelValue"])]),s("div",fe,[e[16]||(e[16]=s("label",{class:"text-mute text-sm font-medium"},[w(" Wallet Address "),s("span",{class:"text-red-500"},"*")],-1)),e[17]||(e[17]=s("small",{class:"text-mute"},"Wallet address for this currency for users to deposit",-1)),a(D,{modelValue:t.value.walletAddress,"onUpdate:modelValue":e[7]||(e[7]=l=>t.value.walletAddress=l),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),s("div",ye,[e[18]||(e[18]=s("label",{class:"text-mute text-sm font-medium"}," Wallet Address Network ",-1)),a(D,{modelValue:t.value.walletAddressNetwork,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.walletAddressNetwork=l),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),s("div",ge,[e[19]||(e[19]=s("label",{class:"text-mute text-sm font-medium"}," Withdrawable",-1)),e[20]||(e[20]=s("small",{class:"text-mute"}," Choose whether users can withdraw funds with this currency ",-1)),a(z,{modelValue:t.value.isAvailableForWithdrawal,"onUpdate:modelValue":e[9]||(e[9]=l=>t.value.isAvailableForWithdrawal=l),onLabel:"Yes",offLabel:"No"},null,8,["modelValue"])]),t.value.isAvailableForWithdrawal?(_(),N("div",be,[e[21]||(e[21]=s("label",{class:"text-mute text-sm font-medium"},[w(" Withdrawal Charge (USD) "),s("span",{class:"text-red-500"},"*")],-1)),a(W,{modelValue:t.value.withdrawalCharge,"onUpdate:modelValue":e[10]||(e[10]=l=>t.value.withdrawalCharge=l),prefix:"$","max-fraction-digits":2,fluid:""},null,8,["modelValue"])])):R("",!0),s("div",we,[a($,{onClick:y,loading:o(f)||o(i),disabled:o(f)||o(i)||A.value,label:"Submit",fluid:""},null,8,["loading","disabled"])])])]),_:1},8,["visible","header"])])}}}),xe={class:"flex items-center gap-3"},Ce={class:"text-primary-500 font-semibold"},he={class:"mt-2 md:h-[calc(100dvh-8.5rem)]"},Ve={key:2,class:"h-full w-full overflow-y-auto rounded-lg"},$e={class:"w-8 aspect-square rounded-full overflow-hidden"},De=["src"],Ae={class:"flex gap-4"},qe=E({__name:"currencies",setup(p){const{isLoading:h,error:g,data:r,mutate:d}=le("/api/admins/me/currencies",H),t=async u=>{var c;(c=r.value)!=null&&c.currencies&&await d(()=>Promise.resolve({success:!0,message:"Currency deleted",currencies:[u,...r.value.currencies]}))},f=async u=>{var i;if(!((i=r.value)!=null&&i.currencies))return;const c=r.value.currencies.map(m=>m.id===u.id?u:m);await d(()=>Promise.resolve({success:!0,message:"Currency updated",currencies:c}))},x=async u=>{var i;if(!((i=r.value)!=null&&i.currencies))return;const c=r.value.currencies.filter(m=>m.id!==u);await d(()=>Promise.resolve({success:!0,message:"Currency deleted",currencies:c}))};return(u,c)=>{const i=_e,m=Q,C=Z,V=K,y=T,A=re,n=O,e=q;return _(),U(e,{name:"admin"},{default:b(()=>{var $;return[s("div",null,[a(m,null,{right:b(()=>{var v;return[s("div",xe,[s("p",Ce,S((v=o(r))==null?void 0:v.currencies.length),1),a(i,{onDone:t,"button-label":"New","button-icon":"pi pi-plus"})])]}),_:1}),s("div",he,[o(h)?(_(),U(C,{key:0})):o(g)?(_(),U(V,{key:1,error:o(g),"should-retry":"",onRetry:o(d)},null,8,["error","onRetry"])):($=o(r))!=null&&$.currencies?(_(),N("div",Ve,[a(n,{value:o(r).currencies,size:"small",paginator:"",rows:10,tableStyle:"min-width: 50rem"},{default:b(()=>[a(y,null,{body:b(({data:v})=>[s("div",$e,[s("img",{src:v.image,class:"w-full h-full object-cover"},null,8,De)])]),_:1}),a(y,{field:"name",header:"Name"}),a(y,{field:"walletAddress",header:"Wallet Address"}),a(y,{header:"Exchange Rate"},{body:b(({data:v})=>[w(" $"+S(v.rate),1)]),_:1}),a(y,{header:"Actions"},{body:b(({data:v})=>[s("div",Ae,[a(i,{currency:v,onDone:f,rounded:""},null,8,["currency"]),a(A,{id:v.id,onDelete:x},null,8,["id"])])]),_:1})]),_:1},8,["value"])])):R("",!0)])])]}),_:1})}}});export{qe as default};
