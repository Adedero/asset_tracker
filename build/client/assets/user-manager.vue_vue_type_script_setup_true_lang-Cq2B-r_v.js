import{d as Ge,h as g,Y as Ee,j as ve,i as $e,b as v,a as l,q as i,r as Ce,s as De,D as Re,w as Be,e as E,c as fe,v as r,p,x as b,o as u}from"./main-DbwiCszp.js";import{s as Me}from"./index-C9xlOZnF.js";import{s as je}from"./index-C2bRNVQt.js";import{s as ze}from"./index-Bj_xpqlO.js";import{s as Fe}from"./index-DeLv1j-i.js";import{s as Ae}from"./vue-layout.vue_vue_type_script_setup_true_lang-BNFQYZFa.js";import{_ as Pe}from"./VFileUploader.vue_vue_type_script_setup_true_lang-hIjdf8F3.js";import{u as C}from"./use-fetch-CkegAda4.js";import{c as Le}from"./country-by-name-Di7sd6fA.js";import{I as Te}from"./iconify-D-TZBpbX.js";import{L as he}from"./login.schema-BTravW_w.js";import{v as ce}from"./v4-C6aID195.js";const qe={class:"grid gap-4"},He={class:"flex flex-col items-center justify-center gap-1"},Ye={class:"w-24 aspect-square overflow-hidden rounded-full"},Je=["src"],Ke={class:"flex items-start gap-1"},Oe={class:"grid"},Qe={key:0,class:"grid"},We={class:"text-xs text-red-500"},Xe={key:1,class:"grid"},Ze={class:"text-xs text-red-500"},_e={class:"grid"},es={key:0,class:"text-xs text-mute"},ss={key:1,class:"text-xs text-mute"},ts={key:0,class:"mt-1 text-red-500 text-xs"},ls={class:"grid"},as={class:"grid"},os={class:"grid"},is={class:"grid mt-3"},ws=Ge({__name:"user-manager",props:{user:{},role:{default:"USER"}},emits:["done"],setup(t,{emit:ge}){var A,P,L,T,h,q,H,Y,J,K,O,Q;const pe=ge,w=g(!1),D=Ee(),s=g({id:((A=t.user)==null?void 0:A.id)||ce(),name:((P=t.user)==null?void 0:P.name)||"",email:((L=t.user)==null?void 0:L.email)||"",password:((T=t.user)==null?void 0:T.password)||"00000000",image:((h=t.user)==null?void 0:h.image)||"",phoneNumber:((q=t.user)==null?void 0:q.phoneNumber)||"",address:((H=t.user)==null?void 0:H.address)||"",country:((Y=t.user)==null?void 0:Y.country)||"",region:((J=t.user)==null?void 0:J.region)||"",verified:((K=t.user)==null?void 0:K.verified)||!1,role:((O=t.user)==null?void 0:O.role)||t.role||"USER",accountGroupId:((Q=t.user)==null?void 0:Q.accountGroupId)||null}),m=g(),R=g("/api/admins/me/users"),{isFetching:y,error:B,data:xe,execute:be}=C(()=>{var o;return`${R.value}/${(o=t.user)==null?void 0:o.id}`},{immediate:!1}).put(s).json(),{isFetching:V,error:M,data:we,execute:ye}=C(R,{immediate:!1}).post(s).json();async function j(){if(m.value=void 0,t.user)await be();else{if(m.value=he.safeParse({email:s.value.email,password:s.value.password}),!m.value.success)return;await ye()}if(B.value||M.value){D.add({severity:"error",summary:"Failed",detail:(B.value||M.value).message,life:6e3});return}D.add({severity:"success",summary:"Done",detail:t.user?"User updated successfully":"New user created",life:3e3}),w.value=!1;const o=t.user?xe.value.user:we.value.user;pe("done",o)}const z=ve(()=>!s.value.name||!s.value.email||!s.value.role||!t.user&&(!s.value.password||s.value.password.length<8)),Ve=()=>{var o,e,f,I,k,n,N,S,c,G,d,x;s.value={id:((o=t.user)==null?void 0:o.id)||ce(),name:((e=t.user)==null?void 0:e.name)||"",email:((f=t.user)==null?void 0:f.email)||"",password:((I=t.user)==null?void 0:I.password)||"00000000",image:((k=t.user)==null?void 0:k.image)||"",phoneNumber:((n=t.user)==null?void 0:n.phoneNumber)||"",address:((N=t.user)==null?void 0:N.address)||"",country:((S=t.user)==null?void 0:S.country)||"",region:((c=t.user)==null?void 0:c.region)||"",verified:((G=t.user)==null?void 0:G.verified)||!1,role:((d=t.user)==null?void 0:d.role)||t.role||"USER",accountGroupId:((x=t.user)==null?void 0:x.accountGroupId)||null}},Ue=ve(()=>t.user?t.user.verified?"User's account is already verified. If set as 'not verified', the user will need to verify their account again to log in.":"User's account is not verified. If set as 'verified', the user will not receive an email to verify their account.":"If set as 'verified', the user will not receive an email to verify their account."),$=g(),U=g();$e(U,o=>{o?s.value.accountGroupId=o.id:s.value.accountGroupId=void 0});const{isFetching:Ie,data:F,error:ke,execute:Ne}=C("/api/admins/me/account-groups",{immediate:!1}).get().json(),Se=async()=>{await Ne(),!(ke.value||!F.value)&&($.value=F.value.accountGroups,U.value=$.value.find(o=>{var e;return((e=t.user)==null?void 0:e.accountGroupId)&&t.user.accountGroupId===o.id}))};return(o,e)=>{const f=De,I=Pe,k=Ae,n=Fe,N=ze,S=je,c=Me,G=Re;return u(),v("div",null,[l("div",{onClick:e[0]||(e[0]=d=>w.value=!0),class:"cursor-pointer"},[Ce(o.$slots,"default",{},()=>[i(f,{label:"Edit Info",icon:"pi pi-user-edit",size:"small"})])]),i(G,{visible:w.value,"onUpdate:visible":e[14]||(e[14]=d=>w.value=d),modal:"",header:o.user?"Edit User":"New User",class:"w-80 md:w-96",onHide:Ve,onShow:Se},{default:Be(()=>{var d,x,W,X,Z,_,ee,se,te,le,ae,oe,ie,re,ue,ne,de;return[l("div",qe,[l("div",He,[l("div",Ye,[s.value.image?(u(),v("img",{key:0,src:s.value.image,class:"w-full h-full object-cover"},null,8,Je)):(u(),fe(r(Te),{key:1,icon:"ic:baseline-account-circle",style:{"font-size":"6rem"},class:"text-primary-500"}))]),l("div",Ke,[(d=o.user)!=null&&d.image?(u(),fe(f,{key:0,onClick:e[1]||(e[1]=a=>s.value.image=""),label:"Remove",icon:"pi pi-times-circle",outlined:"",severity:"danger",size:"small",class:"flex-shrink-0"})):E("",!0),i(I,{size:"small",accept:"image/*","max-file-size":1*1024*1024,onSelect:e[2]||(e[2]=a=>s.value.image=a[0].dataUrl||""),onUpload:j,onCancel:e[3]||(e[3]=a=>{var me;return s.value.image=((me=o.user)==null?void 0:me.image)||""}),class:"w-full",loading:r(y)||r(V),disabled:r(y)||r(V)||z.value},null,8,["loading","disabled"])])]),i(k),l("div",Oe,[e[15]||(e[15]=l("label",{class:"text-mute text-sm font-medium"},[p(" Name "),l("span",{class:"text-red-500"},"*")],-1)),i(n,{modelValue:s.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.name=a),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),o.user?E("",!0):(u(),v("div",Qe,[e[16]||(e[16]=l("label",{class:"text-mute text-sm font-medium"},[p(" Email "),l("span",{class:"text-red-500"},"*")],-1)),i(n,{modelValue:s.value.email,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.email=a),modelModifiers:{trim:!0},fluid:"",invalid:!!((Z=(X=(W=(x=m.value)==null?void 0:x.error)==null?void 0:W.flatten())==null?void 0:X.fieldErrors.email)!=null&&Z[0])},null,8,["modelValue","invalid"]),l("p",We,b((te=(se=(ee=(_=m.value)==null?void 0:_.error)==null?void 0:ee.flatten())==null?void 0:se.fieldErrors.email)==null?void 0:te[0]),1)])),o.user?E("",!0):(u(),v("div",Xe,[e[17]||(e[17]=l("label",{class:"text-mute text-sm font-medium"},[p(" Password "),l("span",{class:"text-red-500"},"*")],-1)),i(N,{modelValue:s.value.password,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.password=a),modelModifiers:{trim:!0},fluid:"","toggle-mask":"",invalid:!!((ie=(oe=(ae=(le=m.value)==null?void 0:le.error)==null?void 0:ae.flatten())==null?void 0:oe.fieldErrors.password)!=null&&ie[0])},null,8,["modelValue","invalid"]),l("p",Ze,b((de=(ne=(ue=(re=m.value)==null?void 0:re.error)==null?void 0:ue.flatten())==null?void 0:ne.fieldErrors.password)==null?void 0:de[0]),1),e[18]||(e[18]=l("p",{class:"text-xs text-mute"},"Password is automatically set to '00000000' (8 zeros)",-1))])),l("div",_e,[e[19]||(e[19]=l("label",{class:"text-mute text-sm font-medium"},[p(" Account Verification Status "),l("span",{class:"text-red-500"},"*")],-1)),i(S,{modelValue:s.value.verified,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.verified=a),onLabel:"Verified",offLabel:"Not Verified"},null,8,["modelValue"]),o.user?(u(),v("p",es,b(Ue.value),1)):(u(),v("p",ss," If set as 'verified', the user will not receive an email to verify their account. "))]),l("div",null,[e[20]||(e[20]=l("label",{class:"text-mute text-sm font-medium"},[p(" Account Group "),l("span",{class:"text-red-500"},"*")],-1)),i(c,{loading:r(Ie),modelValue:U.value,"onUpdate:modelValue":e[8]||(e[8]=a=>U.value=a),options:$.value,"option-label":"name",placeholder:"Select a group",class:"w-full"},null,8,["loading","modelValue","options"]),e[21]||(e[21]=l("p",{class:"mt-1 text-mute text-xs"},"Assign this user to a defined group.",-1))]),l("div",null,[e[22]||(e[22]=l("label",{class:"text-mute text-sm font-medium"},[p(" Role "),l("span",{class:"text-red-500"},"*")],-1)),i(c,{modelValue:s.value.role,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.role=a),options:["USER","ADMIN"],placeholder:"Select a role",class:"w-full"},null,8,["modelValue"]),o.user&&o.user.role!==s.value.role?(u(),v("p",ts," Role changed from "+b(o.user.role)+" to "+b(s.value.role)+". Be sure of this action before proceeding. ",1)):E("",!0)]),l("div",ls,[e[23]||(e[23]=l("label",{class:"text-mute text-sm font-medium"},"Phone Number ",-1)),i(n,{modelValue:s.value.phoneNumber,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.phoneNumber=a),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),l("div",as,[e[24]||(e[24]=l("label",{class:"text-mute text-sm font-medium"},"Address",-1)),i(n,{modelValue:s.value.address,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.address=a),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),l("div",null,[e[25]||(e[25]=l("label",{class:"text-mute text-sm font-medium"},"Country",-1)),i(c,{"default-value":s.value.country?{country:s.value.country}:void 0,options:r(Le),editable:"","option-label":"country",fluid:"","show-clear":"",onValueChange:e[12]||(e[12]=a=>s.value.country=(a==null?void 0:a.country)??"")},null,8,["default-value","options"])]),l("div",os,[e[26]||(e[26]=l("label",{class:"text-mute text-sm font-medium"},"State/Region",-1)),i(n,{modelValue:s.value.region,"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.region=a),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),l("div",is,[i(f,{onClick:j,loading:r(y)||r(V),disabled:r(y)||r(V)||z.value,label:"Submit",icon:"pi pi-check-circle",fluid:""},null,8,["loading","disabled"])])])]}),_:1},8,["visible","header"])])}}});export{ws as _};
