import{u as C,_ as W,b as H,m as X,a as Y}from"./vue-layout.vue_vue_type_script_setup_true_lang-BNFQYZFa.js";import{d as G,u as J,h as l,y as K,B as Q,k as Z,c as E,w as V,A as ee,a as t,q as i,b as m,e as f,v as s,x as te,F as se,f as ae,s as le,C as ie,D as oe,o as a}from"./main-DbwiCszp.js";import{s as ne,a as re}from"./index-DuAAQpbC.js";import{_ as ue}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-CPslCPqh.js";import{u as me}from"./use-error-CqFdhsel.js";import"./index-DeLv1j-i.js";import"./index-BxwU-vK-.js";import"./index-55yS1M7a.js";const de={class:"w-full md:w-[26rem] h-full md:p-10 md:bg-white dark:bg-transparent"},ce={key:0},fe={key:0,class:"font-semibold"},pe={class:"mt-8"},ve={key:1,class:"grid gap-3"},ge={class:"grid grid-cols-6 gap-2"},ye={class:"flex flex-col gap-1"},_e={key:4,class:"mt-3"},be={class:"mt-2 flex flex-col items-center justify-center gap-2"},N=30,xe=10,ke=120,Ae=G({__name:"email-verification",setup(he){var w,S,M,P;J({title:`Email Verification - ${ee}`});const p=K(),o=l(atob(((w=p.query.e)==null?void 0:w.toString())||"")),d=l(atob(((S=p.query.ev)==null?void 0:S.toString())||"")),b=l(((M=p.query.v)==null?void 0:M.toString())||""),x=l(((P=p.query.i)==null?void 0:P.toString())||""),v=l(!1),n=l(""),r=l(0),k=l(0),{pause:q,resume:D}=Q(1e3,{controls:!0,immediate:!1,callback:()=>{if(r.value===0){q();return}r.value-=1}}),{state:L,isLoading:g,error:y,execute:h}=C().sendVerificationEmail({onSuccess:async c=>{k.value++,r.value=k.value>1?Math.min(N+(k.value-1)*xe,ke):N,D()}}),{isLoading:_,error:T,execute:$}=C().verifyEmail(),O=()=>{g.value||!n.value||n.value.length!==6||$(0,{email:o.value,emailToVerify:d.value,otp:n.value,token:b.value,id:x.value}).then(c=>{c&&(v.value=!0)})};return Z(()=>{if(b.value&&x.value){$(0,{token:b.value,id:x.value}).then(c=>{c&&(v.value=!0)});return}if(o.value){h(0,{email:o.value,emailToVerify:d.value});return}me({status:500,message:"Verification failed. Please log in to verify your email."})}),(c,e)=>{const R=H,A=ue,I=ne,z=re,B=le,F=Y,j=oe,U=W;return a(),E(U,{name:"auth"},{default:V(()=>[t("div",de,[i(R,{size:"24"}),t("header",null,[e[6]||(e[6]=t("h1",{class:"text-3xl md:text-4xl font-semibold"},"Email Verification",-1)),!s(g)&&!s(y)?(a(),m("div",ce,[e[4]||(e[4]=t("p",{class:"text-mute"},"Enter the OTP that has been sent to your email address.",-1)),o.value?(a(),m("p",fe,te(s(X)(d.value||o.value)),1)):f("",!0),e[5]||(e[5]=t("p",{class:"mt-1 text-xs text-primary-500 font-semibold"}," Don't forget to check your spam folder too. ",-1))])):f("",!0)]),t("div",pe,[!s(_)&&s(T)?(a(),E(A,{key:0,error:s(T)},null,8,["error"])):f("",!0),s(g)?(a(),m("div",ve,[t("div",ge,[(a(),m(se,null,ae(6,u=>i(I,{key:u,width:"100%",height:"3rem","border-radius":"0.5rem"})),64))]),i(I,{width:"100%",height:"3rem","border-radius":"0.5rem"})])):s(y)?(a(),E(A,{key:2,error:s(y),"should-retry":"",onRetry:e[0]||(e[0]=u=>s(h)(0,{email:o.value,emailToVerify:d.value})),class:"mt-3"},null,8,["error"])):s(L)?(a(),m("form",{key:3,onSubmit:ie(O,["prevent"]),class:"flex flex-col gap-4 w-full"},[t("div",ye,[e[7]||(e[7]=t("label",{for:"otp",class:"text-mute text-sm"},"Enter your OTP",-1)),i(z,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=u=>n.value=u),id:"otp",name:"otp",mask:"",length:6,fluid:"",class:"*:w-full"},null,8,["modelValue"])]),i(B,{disabled:s(_)||!n.value||n.value.length!==6,loading:s(_),type:"submit",label:s(_)?"Verifying":"Submit","icon-pos":"right",icon:"pi pi-check-circle",fluid:""},null,8,["disabled","loading","label"])],32)):f("",!0),!s(g)&&!s(y)?(a(),m("div",_e,[e[8]||(e[8]=t("span",null,"Didn't get the email? ",-1)),i(B,{onClick:e[2]||(e[2]=u=>s(h)(0,{email:o.value,emailToVerify:d.value})),disabled:r.value>0,label:`Resend ${r.value>0?`in ${r.value}${r.value>1?"s":""}`:""}`,text:""},null,8,["disabled","label"])])):f("",!0)]),i(j,{visible:v.value,"onUpdate:visible":e[3]||(e[3]=u=>v.value=u),header:"Email Verified",modal:"",closable:!1,class:"w-80"},{default:V(()=>[t("div",be,[e[10]||(e[10]=t("span",{class:"pi pi-check-circle text-green-500",style:{"font-size":"35px"}},null,-1)),i(F,null,{default:V(()=>e[9]||(e[9]=[t("div",{class:"text-center"},[t("p",null,"Your email has been verified and you are being redirected."),t("p",{class:"flex items-center justify-center gap-2"},[t("span",null,"Please, wait..."),t("span",{class:"pi pi-spin pi-spinner",style:{"font-size":"24px"}})])],-1)])),_:1,__:[9]})])]),_:1},8,["visible"])])]),_:1})}}});export{Ae as default};
