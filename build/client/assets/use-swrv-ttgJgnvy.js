import{aJ as U,h as $,z as q,k as N,m as Q,i as X,aS as Y,aT as Z}from"./main-CE88ee4Q.js";var _=new WeakMap,W=0;function ee(r){if(!r.length)return"";for(var n="arg",t=0;t<r.length;++t){var i=void 0;r[t]===null||typeof r[t]!="object"&&typeof r[t]!="function"?typeof r[t]=="string"?i='"'+r[t]+'"':i=String(r[t]):_.has(r[t])?i=_.get(r[t]):(i=W,_.set(r[t],W++)),n+="@"+i}return n}function te(r){if(typeof r=="function")try{r=r()}catch{r=""}return Array.isArray(r)?r=ee(r):r=String(r||""),r}var k=function(){function r(n){n===void 0&&(n=0),this.items=new Map,this.ttl=n}return r.prototype.serializeKey=function(n){return te(n)},r.prototype.get=function(n){var t=this.serializeKey(n);return this.items.get(t)},r.prototype.set=function(n,t,i){var a=this.serializeKey(n),e=i||this.ttl,o=Date.now(),d={data:t,createdAt:o,expiresAt:e?o+e:1/0};this.dispatchExpire(e,d,a),this.items.set(a,d)},r.prototype.dispatchExpire=function(n,t,i){var a=this;n&&setTimeout(function(){var e=Date.now(),o=e>=t.expiresAt;o&&a.delete(i)},n)},r.prototype.delete=function(n){this.items.delete(n)},r}();function re(){return typeof navigator.onLine<"u"?navigator.onLine:!0}function ne(){return typeof document<"u"&&typeof document.visibilityState<"u"?document.visibilityState!=="hidden":!0}var ie=function(r){return fetch(r).then(function(n){return n.json()})};const x={isOnline:re,isDocumentVisible:ne,fetcher:ie};var g=function(){return g=Object.assign||function(r){for(var n,t=1,i=arguments.length;t<i;t++){n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])}return r},g.apply(this,arguments)},E=function(r,n,t,i){function a(e){return e instanceof t?e:new t(function(o){o(e)})}return new(t||(t=Promise))(function(e,o){function d(l){try{u(i.next(l))}catch(y){o(y)}}function c(l){try{u(i.throw(l))}catch(y){o(y)}}function u(l){l.done?e(l.value):a(l.value).then(d,c)}u((i=i.apply(r,n||[])).next())})},V=function(r,n){var t={label:0,sent:function(){if(e[0]&1)throw e[1];return e[1]},trys:[],ops:[]},i,a,e,o;return o={next:d(0),throw:d(1),return:d(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function d(u){return function(l){return c([u,l])}}function c(u){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,a&&(e=u[0]&2?a.return:u[0]?a.throw||((e=a.return)&&e.call(a),0):a.next)&&!(e=e.call(a,u[1])).done)return e;switch(a=0,e&&(u=[u[0]&2,e.value]),u[0]){case 0:case 1:e=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,a=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(e=t.trys,!(e=e.length>0&&e[e.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!e||u[1]>e[0]&&u[1]<e[3])){t.label=u[1];break}if(u[0]===6&&t.label<e[1]){t.label=e[1],e=u;break}if(e&&t.label<e[2]){t.label=e[2],t.ops.push(u);break}e[2]&&t.ops.pop(),t.trys.pop();continue}u=n.call(r,t)}catch(l){u=[6,l],a=0}finally{i=e=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},ae=function(r,n){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),a,e=[],o;try{for(;(n===void 0||n-- >0)&&!(a=i.next()).done;)e.push(a.value)}catch(d){o={error:d}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return e},ue=function(r,n,t){if(t||arguments.length===2)for(var i=0,a=n.length,e;i<a;i++)(e||!(i in n))&&(e||(e=Array.prototype.slice.call(n,0,i)),e[i]=n[i]);return r.concat(e||Array.prototype.slice.call(n))},P=new k,S=new k,F=new k,G={cache:P,refreshInterval:0,ttl:0,serverTTL:1e3,dedupingInterval:2e3,revalidateOnFocus:!0,revalidateDebounce:0,shouldRetryOnError:!0,errorRetryInterval:5e3,errorRetryCount:5,fetcher:x.fetcher,isOnline:x.isOnline,isDocumentVisible:x.isDocumentVisible};function oe(r,n,t){var i=S.get(r);if(i)i.data.push(n);else{var a=5e3;S.set(r,[n],t>0?t+a:t)}}function fe(r,n,t){if(t.isDocumentVisible()&&!(t.errorRetryCount!==void 0&&n>t.errorRetryCount)){var i=Math.min(n||0,t.errorRetryCount),a=i*t.errorRetryInterval;setTimeout(function(){r(null,{errorRetryCount:i+1,shouldRetryOnError:!0})},a)}}var B=function(r,n,t,i){return t===void 0&&(t=P),i===void 0&&(i=G.ttl),E(void 0,void 0,void 0,function(){var a,e,o,d,c,u,l;return V(this,function(y){switch(y.label){case 0:if(!le(n))return[3,5];y.label=1;case 1:return y.trys.push([1,3,,4]),[4,n];case 2:return a=y.sent(),[3,4];case 3:return d=y.sent(),e=d,[3,4];case 4:return[3,6];case 5:a=n,y.label=6;case 6:if(o=!1,c={data:a,error:e,isValidating:o},typeof a<"u")try{t.set(r,c,i)}catch(v){console.error("swrv(mutate): failed to set cache",v)}return u=S.get(r),u&&u.data.length&&(l=u.data.filter(function(v){return v.key===r}),l.forEach(function(v,f){typeof c.data<"u"&&(v.data=c.data),v.error=c.error,v.isValidating=c.isValidating,v.isLoading=c.isValidating;var b=f===l.length-1;b||delete l[f]}),l=l.filter(Boolean)),[2,c]}})})};function ce(){for(var r=this,n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var i,a,e=g({},G),o=!1,d=!1,c=U(),u=(c==null?void 0:c.proxy)||c;if(!u)return console.error("Could not get current instance, check to make sure that `useSwrv` is declared in the top level of the setup function."),null;var l=(u==null?void 0:u.$isServer)||!1;n.length>=1&&(i=n[0]),n.length>=2&&(a=n[1]),n.length>2&&(e=g(g({},e),n[2]));var y=l?e.serverTTL:e.ttl,v=typeof i=="function"?i:$(i);typeof a>"u"&&(a=e.fetcher);var f=null;f||(f=q({data:void 0,error:void 0,isValidating:!0,isLoading:!0,key:null}));var b=function(h,s){return E(r,void 0,void 0,function(){var j,m,C,R,I,z,D,M=this;return V(this,function(L){switch(L.label){case 0:return j=f.data===void 0,m=v.value,m?(C=e.cache.get(m),R=C&&C.data,f.isValidating=!0,f.isLoading=!R,R&&(f.data=R.data,f.error=R.error),I=h||a,!I||!e.isDocumentVisible()&&!j||(s==null?void 0:s.forceRevalidate)!==void 0&&!(s!=null&&s.forceRevalidate)?(f.isValidating=!1,f.isLoading=!1,[2]):C&&(z=!!(Date.now()-C.createdAt>=e.dedupingInterval||s!=null&&s.forceRevalidate),!z)?(f.isValidating=!1,f.isLoading=!1,[2]):(D=function(){return E(M,void 0,void 0,function(){var w,H,T,K;return V(this,function(O){switch(O.label){case 0:return w=F.get(m),w?[3,2]:(H=Array.isArray(m)?m:[m],T=I.apply(void 0,ue([],ae(H),!1)),F.set(m,T,e.dedupingInterval),[4,B(m,T,e.cache,y)]);case 1:return O.sent(),[3,4];case 2:return[4,B(m,w.data,e.cache,y)];case 3:O.sent(),O.label=4;case 4:return f.isValidating=!1,f.isLoading=!1,F.delete(m),f.error!==void 0&&(K=!o&&e.shouldRetryOnError&&(s?s.shouldRetryOnError:!0),K&&fe(b,s?s.errorRetryCount:1,e)),[2]}})})},R&&e.revalidateDebounce?(setTimeout(function(){return E(M,void 0,void 0,function(){return V(this,function(w){switch(w.label){case 0:return o?[3,2]:[4,D()];case 1:w.sent(),w.label=2;case 2:return[2]}})})},e.revalidateDebounce),[3,3]):[3,1])):[2];case 1:return[4,D()];case 2:L.sent(),L.label=3;case 3:return[2]}})})},A=function(){return E(r,void 0,void 0,function(){return V(this,function(h){return[2,b(null,{shouldRetryOnError:!1})]})})},p=null;N(function(){var h=function(){return E(r,void 0,void 0,function(){return V(this,function(s){switch(s.label){case 0:return!f.error&&e.isOnline()?[4,b()]:[3,2];case 1:return s.sent(),[3,3];case 2:p&&clearTimeout(p),s.label=3;case 3:return e.refreshInterval&&!o&&(p=setTimeout(h,e.refreshInterval)),[2]}})})};e.refreshInterval&&(p=setTimeout(h,e.refreshInterval)),e.revalidateOnFocus&&(document.addEventListener("visibilitychange",A,!1),window.addEventListener("focus",A,!1))}),Q(function(){o=!0,p&&clearTimeout(p),e.revalidateOnFocus&&(document.removeEventListener("visibilitychange",A,!1),window.removeEventListener("focus",A,!1));var h=S.get(v.value);h&&(h.data=h.data.filter(function(s){return s!==f}))});try{X(v,function(h){Y(v)||(v.value=h),f.key=h,f.isValidating=!!h,oe(v.value,f,y),!l&&!d&&v.value&&b(),d=!1},{immediate:!0})}catch{}var J=g(g({},Z(f)),{mutate:function(h,s){return b(h,g(g({},s),{forceRevalidate:!0}))}});return J}function le(r){return r!==null&&typeof r=="object"&&typeof r.then=="function"}export{ce as u};
