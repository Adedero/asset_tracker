import{_ as te,r as se,j as ae}from"./vue-layout.vue_vue_type_script_setup_true_lang-Dd9kIAe8.js";import{_ as le}from"./VCard.vue_vue_type_script_setup_true_lang-va0MW3Xd.js";import{s as ne}from"./index-DHTAa8Us.js";import{s as oe}from"./index-BGiSEDGv.js";import{s as ie}from"./index-Drofbpnb.js";import{_ as de}from"./VFileUploader.vue_vue_type_script_setup_true_lang-DHTQRJoi.js";import{_ as me}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-U_TlgEzX.js";import{d as ue,Y as re,y as ce,h as _,i as pe,k as ve,j as fe,c as y,w as g,a as t,q as i,s as _e,v as d,x as A,b as k,e as R,N as ge,p as c,F as xe,f as Ve,V as be,o as r}from"./main-CE88ee4Q.js";import{_ as he}from"./VNavbar.vue_vue_type_script_setup_true_lang-GcHfqelS.js";import{u as J}from"./use-fetch-CNl_4VEC.js";import{t as ye}from"./investment-tier-C6RGqzcN.js";import"./bundle-mjs-CLJs87Zn.js";import"./iconify-0_DS-cBL.js";import"./index-wutX35Rh.js";import"./index-BPNPmUFq.js";const ke={class:"font-semibold text-primary-500 text-lg"},$e={class:"flex items-center gap-2"},Ue={class:"mt-2 md:h-[calc(100dvh-9rem)]"},we={key:2,class:"h-full w-full"},Ne={class:"grid md:grid-cols-3 gap-4 h-full"},Ce={class:"md:col-span-1"},Re={class:"grid gap-2"},De={class:"bg-slate-200 dark:bg-slate-700 rounded-md h-60 overflow-hidden"},Pe=["src"],Fe={class:"mt-2"},Se={class:"grid gap-4"},Te={class:"grid"},Ie={class:"grid"},je={class:"md:col-span-2 h-full overflow-y-auto"},ze={key:0,class:"grid gap-4"},Be={class:"flex items-center justify-between gap-3"},Ee={class:"text-mute font-semibold"},Me={class:"mt-2 grid grid-cols-[repeat(auto-fill,minmax(200px,1fr))] gap-x-4 gap-y-6"},Le={class:"grid relative"},Ae={key:0,class:"text-red-500 absolute -bottom-5"},Je={class:"grid"},Oe={class:"grid"},qe={class:"grid"},Ye={class:"grid"},mt=ue({__name:"investment-plan-editor",setup(Ge){const D=ce(),O=be(),$=re(),u=D.params.investment_plan_id?D.params.investment_plan_id.toString():void 0,{isFetching:q,error:P,data:p,execute:F}=J(()=>`/api/admins/me/investment-plans/${u}`,{immediate:!1}).get().json(),s=_({});pe(()=>s.value.name,l=>{s.value.slug=ae(l)}),ve(async()=>{u&&(await F(),p.value&&(s.value=p.value.investmentPlan,T.value=s.value.image||"",S()))});function S(){var l;s.value.tiers=(l=s.value.tiers)==null?void 0:l.sort((e,n)=>e.minimumDeposit-n.minimumDeposit)}const T=_(""),Y=_([...ye]),I=fe(()=>{const{name:l,slug:e,image:n,tiers:m}=s.value;return!l||!e||!n||!(m!=null&&m.length)||m.some(({name:v,minimumDeposit:f,expectedReturnRate:N,duration:V,terminationFee:b})=>!v||!f||!N||!V||b===void 0||b===null)}),U=_(!1),w=_(""),G=(l,e)=>{var n,m;(m=(n=s.value)==null?void 0:n.tiers)!=null&&m.some((v,f)=>v.name===l&&f!==e)?(U.value=!0,w.value=l):(U.value=!1,w.value="")},{isFetching:x,error:j,data:z,execute:H}=J(()=>u?`/api/admins/me/investment-plans/${u}`:"/api/admins/me/investment-plans",{immediate:!1})[u?"put":"post"](s).json(),B=async()=>{if(U.value){$.add({severity:"warn",summary:"Duplicate name found",detail:`A ${w.value} tier already exists.`,life:5e3});return}if(s.value=se(s.value),S(),await H(),j.value||!z.value){$.add({severity:"error",summary:"Error",detail:j.value.message});return}if(!u){await O.push({name:"admin-investment-plans"});return}$.add({severity:"success",summary:"Success",detail:"Investment plan updated successfully",life:3e3}),p.value={success:!0,message:"Investment plan updated",investmentPlan:z.value.investmentPlan}},K=()=>{var l,e;!s.value||!((l=p.value)!=null&&l.investmentPlan)||(s.value=JSON.parse(JSON.stringify((e=p.value)==null?void 0:e.investmentPlan)))},Q=()=>{var l,e,n;s.value={...s.value,tiers:[{name:`Tier ${(((e=(l=s.value)==null?void 0:l.tiers)==null?void 0:e.length)??0)+1}`,minimumDeposit:0,duration:0,expectedReturnRate:0,terminationFee:0},...((n=s.value)==null?void 0:n.tiers)??[]]}},W=l=>{!s.value||!s.value.tiers||(s.value={...s.value,tiers:s.value.tiers.filter(e=>e!==l)})};return(l,e)=>{const n=_e,m=he,v=ge,f=me,N=de,V=ie,b=oe,h=ne,X=le,Z=te;return r(),y(Z,{name:"admin"},{default:g(()=>{var E;return[t("div",null,[i(m,null,{left:g(()=>[t("p",ke,A(s.value.name??"New Investment Plan"),1)]),right:g(()=>[t("div",$e,[i(n,{onClick:Q,label:"Add Tier",icon:"pi pi-plus",outlined:"",size:"small",class:"md:flex-shrink-0"}),i(n,{onClick:B,label:"Save",icon:"pi pi-save",size:"small",loading:d(x),disabled:d(x)||I.value},null,8,["loading","disabled"]),i(n,{label:"Revert",icon:"pi pi-refresh",severity:"secondary",size:"small",onClick:K})])]),_:1}),t("div",Ue,[d(q)?(r(),y(v,{key:0})):d(P)?(r(),y(f,{key:1,error:d(P),"should-retry":"",onRetry:e[0]||(e[0]=a=>d(F)())},null,8,["error"])):d(u)&&((E=d(p))!=null&&E.investmentPlan)||!d(u)&&s.value?(r(),k("div",we,[t("div",Ne,[t("div",Ce,[t("div",Re,[t("div",De,[t("img",{src:s.value.image||"",class:"w-full h-full object-cover"},null,8,Pe)]),i(N,{size:"small",accept:"image/*","max-file-size":1*1024*1024,onSelect:e[1]||(e[1]=a=>s.value.image=a[0].dataUrl??""),onUpload:B,onCancel:e[2]||(e[2]=a=>s.value.image=T.value??""),class:"w-full",loading:d(x),disabled:d(x)||I.value},null,8,["loading","disabled"])]),t("div",Fe,[t("div",Se,[t("div",Te,[e[5]||(e[5]=t("label",{class:"text-mute text-sm font-semibold"},[c(" Name "),t("span",{class:"text-red-500"},"*")],-1)),i(V,{modelValue:s.value.name,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.name=a),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])]),t("div",Ie,[e[6]||(e[6]=t("label",{class:"text-mute text-sm font-semibold"},[c(" Slug "),t("span",{class:"text-red-500"},"*")],-1)),i(V,{modelValue:s.value.slug,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.slug=a),modelModifiers:{trim:!0},fluid:""},null,8,["modelValue"])])])])]),t("div",je,[s.value.tiers?(r(),k("div",ze,[(r(!0),k(xe,null,Ve(s.value.tiers,(a,M)=>(r(),y(X,{key:a.name,header:a.name},{header:g(()=>[t("div",Be,[t("p",Ee,A(a.name),1),i(n,{onClick:C=>W(a),icon:"pi pi-trash",text:"",severity:"danger",rounded:"",size:"small"},null,8,["onClick"])])]),default:g(()=>{var C,L;return[t("div",Me,[t("div",Le,[e[7]||(e[7]=t("label",{class:"text-mute text-sm font-semibold"},[c(" Name "),t("span",{class:"text-red-500"},"*")],-1)),i(b,{options:Y.value,modelValue:a.name,"onUpdate:modelValue":o=>a.name=o,onChange:o=>G(o.value,M),fluid:""},null,8,["options","modelValue","onUpdate:modelValue","onChange"]),(L=(C=s.value)==null?void 0:C.tiers)!=null&&L.some((o,ee)=>o.name===a.name&&ee!==M)?(r(),k("small",Ae," Duplicate name found ")):R("",!0)]),t("div",Je,[e[8]||(e[8]=t("label",{class:"text-mute text-sm font-semibold"},[c(" Minimum Deposit "),t("span",{class:"text-red-500"},"*")],-1)),i(h,{modelValue:a.minimumDeposit,"onUpdate:modelValue":o=>a.minimumDeposit=o,prefix:"$","max-fraction-digits":2,fluid:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Oe,[e[9]||(e[9]=t("label",{class:"text-mute text-sm font-semibold"},[c(" Duration (days) "),t("span",{class:"text-red-500"},"*")],-1)),i(h,{modelValue:a.duration,"onUpdate:modelValue":o=>a.duration=o,fluid:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",qe,[e[10]||(e[10]=t("label",{class:"text-mute text-sm font-semibold"},[c(" Expected Return Rate "),t("span",{class:"text-red-500"},"*")],-1)),i(h,{modelValue:a.expectedReturnRate,"onUpdate:modelValue":o=>a.expectedReturnRate=o,suffix:"%","max-fraction-digits":2,fluid:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Ye,[e[11]||(e[11]=t("label",{class:"text-mute text-sm font-semibold"},[c(" Termination Fee "),t("span",{class:"text-red-500"},"*")],-1)),i(h,{modelValue:a.terminationFee,"onUpdate:modelValue":o=>a.terminationFee=o,prefix:"$","max-fraction-digits":2,fluid:""},null,8,["modelValue","onUpdate:modelValue"])])])]}),_:2},1032,["header"]))),128))])):R("",!0)])])])):R("",!0)])])]}),_:1})}}});export{mt as default};
