import{u as I,_ as se,b as te,a as ae}from"./vue-layout.vue_vue_type_script_setup_true_lang-BNFQYZFa.js";import{d as oe,u as le,M as R,h as n,y as ne,z as re,B as ie,k as ue,c as A,w as o,A as de,a as t,q as s,b as _,e as B,v as r,F as ce,f as pe,s as me,x as _e,D as ve,o as i}from"./main-DbwiCszp.js";import{s as fe,a as ge,b as be,c as we,d as ye}from"./index-C8GIUcSa.js";import{h as he,s as ke}from"./index-3d24_D8i.js";import{s as xe}from"./index-Bj_xpqlO.js";import{s as Pe,a as $e}from"./index-DuAAQpbC.js";import{_ as Se}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-CPslCPqh.js";import{u as Ee}from"./use-error-CqFdhsel.js";import{o as Te,s as Ve}from"./types-CPE1WPKY.js";import"./index-DeLv1j-i.js";import"./index-BxwU-vK-.js";import"./index-55yS1M7a.js";const Me={class:"w-full md:w-[26rem] h-full md:p-10 md:bg-white dark:bg-transparent"},Ce={key:0},Ie={key:1,class:"grid gap-3"},Re={class:"grid grid-cols-6 gap-2"},Ae={key:2},Be={class:"flex flex-col gap-6 w-full"},Ne={class:"flex flex-col gap-1"},Oe={class:"flex justify-end"},Le={class:"mt-3"},je={class:"grid gap-1"},qe={key:0,class:"font-medium text-red-500"},De={class:"flex pt-6 justify-between"},ze={class:"mt-2 flex flex-col items-center justify-center gap-2"},N=30,Fe=10,Ue=120,ls=oe({__name:"password-reset",setup(We){var k,x;le({title:`Password Reset - ${de}`});const b=ne(),O=Te({password:Ve({message:"Password is required"}).min(R,{message:`Password must contain at least ${R} characters`})}),u=n(atob(((k=b.query.e)==null?void 0:k.toString())||"")),d=n((x=b.query.i)==null?void 0:x.toString()),c=n(""),f=n(!1),L=re({password:""}),j=n(he(O)),l=n(0),g=n(0),{pause:q,resume:D}=ie(1e3,{controls:!0,immediate:!1,callback:()=>{if(l.value===0){q();return}l.value-=1}}),{isLoading:z,error:w,execute:y}=I().sendOTP({mailOptions:{subject:"Password Recovery",buttonLabel:"Verify",mailReason:"You received this email because you initiated a password reset. If you did not make the request, please log in and change your password immediately"},onSuccess:()=>{g.value++,l.value=g.value>1?Math.min(N+(g.value-1)*Fe,Ue):N,D()}}),{isLoading:h,error:F,execute:U}=I().resetPassword(),W=({valid:P,values:e})=>{!P||h.value||U(0,{id:d.value,email:u.value,password:e.password,otp:c.value}).then(p=>{p!=null&&p.success&&(f.value=!0)})};return ue(()=>{u.value&&d.value||Ee({status:500,message:"Password reset failed. Please start the process again."})}),(P,e)=>{const p=te,$=ge,H=fe,S=Se,E=Pe,Y=$e,v=me,T=we,G=xe,X=ke,J=be,K=ye,Q=ae,Z=ve,ee=se;return i(),A(ee,{name:"auth"},{default:o(()=>[t("div",Me,[s(p,{size:"24"}),s(K,{value:"1",linear:"",class:"dark:bg-transparent"},{default:o(()=>[s(H,null,{default:o(()=>[s($,{value:"1"}),s($,{value:"2"})]),_:1}),s(J,null,{default:o(()=>[s(T,{value:"1",class:"dark:bg-transparent"},{default:o(({activateCallback:m})=>[d.value&&u.value?(i(),_("div",Ce,[r(w)?(i(),A(S,{key:0,error:r(w),"should-retry":"",onRetry:e[0]||(e[0]=a=>r(y)(0,{id:d.value,email:u.value}))},null,8,["error"])):r(z)?(i(),_("div",Ie,[t("div",Re,[(i(),_(ce,null,pe(6,a=>s(E,{key:a,width:"100%",height:"3rem","border-radius":"0.5rem"})),64))]),s(E,{width:"100%",height:"3rem","border-radius":"0.5rem"})])):(i(),_("div",Ae,[t("div",Be,[t("div",Ne,[e[4]||(e[4]=t("label",{for:"otp",class:"text-mute text-sm font-semibold"},"Enter the OTP sent to your email",-1)),s(Y,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),id:"otp",name:"otp",mask:"",length:6,fluid:"",class:"*:w-full"},null,8,["modelValue"])]),t("div",Oe,[s(v,{disabled:!c.value||c.value.length!==6,label:"Next",icon:"pi pi-arrow-right","icon-pos":"right",onClick:a=>m("2")},null,8,["disabled","onClick"])])]),t("div",Le,[e[5]||(e[5]=t("span",null,"Didn't get the email? ",-1)),s(v,{onClick:e[2]||(e[2]=a=>r(y)(0,{id:d.value,email:u.value})),disabled:l.value>0,label:`Resend ${l.value>0?`in ${l.value}${l.value>1?"s":""}`:""}`,text:""},null,8,["disabled","label"])])]))])):B("",!0)]),_:1}),s(T,{value:"2",class:"dark:bg-transparent"},{default:o(({activateCallback:m})=>[s(S,{error:r(F),class:"mb-3"},null,8,["error"]),s(X,{initialValues:L,resolver:j.value,validateOnValueUpdate:!0,validateOnBlur:!0,onSubmit:W},{default:o(a=>{var V,M,C;return[t("div",null,[t("div",je,[e[6]||(e[6]=t("label",{for:"password",class:"text-mute text-sm font-semibold"}," Enter your new password ",-1)),s(G,{id:"password",name:"password","toggle-mask":"",fluid:"","input-class":"dark:bg-slate-800"}),(V=a.password)!=null&&V.invalid?(i(),_("small",qe,_e((C=(M=a.password)==null?void 0:M.error)==null?void 0:C.message),1)):B("",!0)])]),t("div",De,[s(v,{label:"Back",severity:"secondary",icon:"pi pi-arrow-left",onClick:He=>m("1")},null,8,["onClick"]),s(v,{type:"submit",label:"Submit",loading:r(h)},null,8,["loading"])])]}),_:2},1032,["initialValues","resolver"])]),_:1})]),_:1})]),_:1}),s(Z,{visible:f.value,"onUpdate:visible":e[3]||(e[3]=m=>f.value=m),header:"Password Reset",modal:"",closable:!1,class:"w-80"},{default:o(()=>[t("div",ze,[e[8]||(e[8]=t("span",{class:"pi pi-check-circle text-green-500",style:{"font-size":"35px"}},null,-1)),s(Q,null,{default:o(()=>e[7]||(e[7]=[t("div",{class:"text-center"},[t("p",null,"Your password has been successfully reset."),t("p",{class:"flex items-center justify-center gap-2"},[t("span",null,"Please, wait..."),t("span",{class:"pi pi-spin pi-spinner",style:{"font-size":"24px"}})])],-1)])),_:1,__:[7]})])]),_:1},8,["visible"])])]),_:1})}}});export{ls as default};
