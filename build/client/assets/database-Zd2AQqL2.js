import{_ as I}from"./vue-layout.vue_vue_type_script_setup_true_lang-Dd9kIAe8.js";import{_ as J}from"./VCard.vue_vue_type_script_setup_true_lang-va0MW3Xd.js";import{_ as K}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-U_TlgEzX.js";import{d as Q,Y as W,a1 as X,am as Z,h as E,bC as ee,c,w as u,a as o,q as _,s as ae,v as r,e as F,N as te,b as V,f as se,x as $,p as ne,U as oe,F as re,o as l}from"./main-CE88ee4Q.js";import{_ as le}from"./VNavbar.vue_vue_type_script_setup_true_lang-GcHfqelS.js";import{u as v}from"./use-fetch-CNl_4VEC.js";import"./bundle-mjs-CLJs87Zn.js";import"./iconify-0_DS-cBL.js";const ie={class:"mt-2"},de={class:"grid gap-2"},ce={class:"text-primary-500 font-medium text-xs"},ue={key:0,class:"ml-2 text-xs font-semibold p-1 rounded-md bg-emerald-200 text-emerald-600"},me={class:"flex items-center justify-between gap-2"},pe={class:"truncate"},_e={class:"ml-2 text-sm font-semibold"},ve={class:"flex items-center gap-1"},De=Q({__name:"database",async setup(fe){let m,g;const d=W(),j=X(),{isFetching:L,error:b,data:f,execute:N}=([m,g]=Z(()=>v("/api/admins/me/database/backups").get().json()),m=await m,g(),m),t=E(void 0);ee(()=>{var e;(e=f.value)!=null&&e.files&&(t.value=f.value.files)});const{isFetching:y,error:w,data:p,execute:P}=v("/api/admins/me/database/backups",{immediate:!1}).post().json();async function R(){if(!(y.value||!await D("Do you want to create a backup?"))){if(await P(),w.value||!p.value)return d.add({severity:"error",summary:"Error",detail:w.value.message});t.value?t.value=[p.value.file,...t.value]:t.value=[p.value.file],d.add({severity:"success",summary:p.value.message,life:3e3})}}const i=E(null),{isFetching:U,error:k,data:h,execute:Y}=v(()=>`/api/admins/me/database/backups/${i.value}`,{immediate:!1}).get().blob();async function M(e){if(U.value)return;if(i.value=e.filename,e.downloading=!0,await Y().finally(()=>e.downloading=!1),k.value||!h.value)return d.add({severity:"error",summary:"Error",detail:k.value.message});const a=window.URL.createObjectURL(h.value),s=document.createElement("a");s.href=a,s.download=e.filename,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(a),i.value=null}const{isFetching:z,error:x,data:C,execute:A}=v(()=>`/api/admins/me/database/backups/${i.value}`,{immediate:!1}).delete().json();async function T(e){if(t.value&&!(z.value||!await D("Do you want to delete this backup?"))){if(i.value=e.filename,e.deleting=!0,await A().finally(()=>e.deleting=!1),x.value||!C.value)return d.add({severity:"error",summary:"Error",detail:x.value.message});t.value=t.value.filter(a=>a.filename!==e.filename),d.add({severity:"success",summary:C.value.message,life:3e3}),i.value=null}}const D=async e=>await new Promise(a=>{j.require({header:"Confirmation",message:e,icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Proceed"},accept:()=>{a(!0)},reject:()=>{a(!1)}})});return(e,a)=>{const s=ae,q=le,O=te,S=K,B=J,G=I;return l(),c(G,{name:"admin"},{default:u(()=>[o("div",null,[_(q,null,{right:u(()=>[_(s,{loading:r(y),onClick:R,size:"small",label:"Create backup",icon:"pi pi-cloud-upload"},null,8,["loading"])]),_:1}),o("div",ie,[r(L)?(l(),c(O,{key:0})):r(b)?(l(),c(S,{key:1,error:r(b),"should-retry":"",onRetry:a[0]||(a[0]=n=>r(N)())},null,8,["error"])):r(f)&&t.value?(l(),c(B,{key:2,header:"Database Backups"},{default:u(()=>[o("div",de,[(l(!0),V(re,null,se(t.value,n=>(l(),c(B,{key:n.filename,class:"border border-slate-300 dark:border-slate-500"},{header:u(()=>[o("p",ce,[ne(" Created: "+$(r(oe)(n.createdAt,"ddd, DD MMM, YYYY hh:mm aa"))+" ",1),Date.now()-new Date(n.createdAt).getTime()<5e3?(l(),V("span",ue," new ")):F("",!0)])]),default:u(()=>[o("div",me,[o("p",pe,[a[1]||(a[1]=o("span",{class:"pi pi-database bg-amber-200 text-amber-600 p-1.5 rounded-md"},null,-1)),o("span",_e,$(n.filename),1)]),o("div",ve,[_(s,{loading:n.downloading,onClick:H=>M(n),icon:"pi pi-download",outlined:"",size:"small"},null,8,["loading","onClick"]),_(s,{loading:n.deleting,onClick:H=>T(n),icon:"pi pi-trash",severity:"danger",outlined:"",size:"small"},null,8,["loading","onClick"])])])]),_:2},1024))),128))])]),_:1})):F("",!0)])])]),_:1})}}});export{De as default};
