import{_ as K,d as Q,s as X,a as Z}from"./vue-layout.vue_vue_type_script_setup_true_lang-Dd9kIAe8.js";import{d as ee,Y as te,h as f,c as P,w as l,q as s,a as t,s as se,v as c,p as r,b as v,f as ae,ak as oe,al as le,x as _,F as ne,e as x,D as re,o as m}from"./main-CE88ee4Q.js";import{_ as ie}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-U_TlgEzX.js";import{s as ue}from"./index-Drofbpnb.js";import{s as de}from"./index-BGiSEDGv.js";import{_ as me}from"./VCard.vue_vue_type_script_setup_true_lang-va0MW3Xd.js";import{s as pe,a as ce}from"./index-D0QGXrOb.js";import{s as fe}from"./index-DHTAa8Us.js";import{_ as ve}from"./VNavbar.vue_vue_type_script_setup_true_lang-GcHfqelS.js";import{u as I}from"./use-fetch-CNl_4VEC.js";import{v as _e}from"./v4-C6aID195.js";import"./index-wutX35Rh.js";import"./index-BPNPmUFq.js";import"./bundle-mjs-CLJs87Zn.js";import"./iconify-0_DS-cBL.js";const ye={class:"flex items-end gap-2"},ge={class:"pb-2 mt-2 overflow-y-auto md:h-[calc(100dvh-9rem)]"},be={class:"h-full grid gap-2 md:grid-cols-6 lg:grid-cols-7"},xe={class:"md:col-span-2 lg:col-span-3"},Ce={class:"grid gap-2"},De={class:"h-full overflow-y-auto grid gap-4 md:col-span-4 lg:col-span-4 items-start"},Ve={class:"flex items-center justify-between"},Ue={class:"font-semibold text-slate-500"},we={class:"grid gap-2 md:grid-cols-6"},ke={class:"grid gap-1 md:col-span-3"},Ne={class:"grid gap-1 md:col-span-3"},Ge={class:"grid gap-1 md:col-span-6"},Se={class:"grid gap-1 md:col-span-3"},he={class:"grid gap-1 md:col-span-3"},Te={key:0,class:"flex-col-center gap-1"},Ae={class:"text-3xl font-semibold text-emerald-500 bg-emerald-50 rounded-md p-2"},Pe={key:0,class:"mt-1 text-sm"},Ie={key:0},$e={class:"font-semibold text-[var(--color-primary-500)]"},Be={key:1},Ee={class:"font-semibold text-[var(--color-primary-500)]"},qe={class:"mt-4"},Fe="/api/users/me/transactions/deposit/giftcard/initialize",st=ee({__name:"deposit-gift-card",setup(ze){const y=te(),n=f(null),g=f(!1),C=f(!1),u=f([]);function $(a){return a.type!==""&&a.country!==""&&a.cardNumber!==""&&a.pin!==""&&a.amount>0}function B(a){return a.country.toLowerCase()==="united states"?"USD":a.country.toLowerCase()==="canada"?"CAD":a.country.toLowerCase()==="united kingdom"?"GBP":"USD"}function D(a){return u.value.reduce((e,d)=>d.currency===a?e+d.amount:e,0)}function E(){u.value.push({id:_e(),type:"",country:"",cardNumber:"",pin:"",amount:0,currency:"USD",isValid:!1})}const{isFetching:q,data:U,error:F,execute:z}=I(()=>Fe,{immediate:!1}).post(u.value).json();async function L(){if(u.value.length===0){y.add({severity:"warn",summary:"No Cards",detail:"Please add at least one gift card.",life:5e3});return}if(!u.value.every($)){y.add({severity:"error",summary:"Invalid Cards",detail:"One or more cards have missing fields which are required.",life:5e3});return}if(await z(),!U.value||F.value){y.add({severity:"error",summary:"Error",detail:"Failed to create deposit request. Please try again later.",life:5e3});return}n.value=U.value,g.value=!0}const w=f({}),{isFetching:R,error:k,data:j,execute:O}=I("/api/users/me/transactions/deposit",{immediate:!1}).post(w).json();async function Y(){if(!n.value){y.add({severity:"error",summary:"Error",detail:"No deposit request data available. Please, try again later.",life:5e3});return}w.value={transactionType:"DEPOSIT",transactionStatus:"PENDING",amountInUSD:n.value.total,charge:0,actualAmountInUSD:n.value.total,rate:1,currency:"USD",amountInCurrency:n.value.total,isWireTransfer:!1,isGiftCard:!0,giftCardData:{cards:u.value.map(a=>({type:a.type,country:a.country,cardNumber:a.cardNumber,pin:a.pin,amount:a.amount,currency:a.currency})),totalInUSD:n.value.total,rates:n.value.rates}},await O(),!(k.value||!j.value.success)&&(g.value=!1,C.value=!0,u.value=[],n.value=null)}return(a,e)=>{const d=se,M=ve,p=ce,b=fe,V=pe,N=me,G=de,S=ue,W=ie,h=X,H=Z,T=re,J=K;return m(),P(J,{name:"user"},{default:l(()=>[s(M,null,{left:l(()=>e[3]||(e[3]=[t("h1",{class:"cursor-context-menu text-lg font-semibold text-primary-500 dark:text-primary-400"}," Gift Card Deposit ",-1)])),right:l(()=>[t("div",ye,[s(d,{loading:c(q),onClick:L,label:"Proceed",size:"small","icon-pos":"right",icon:"pi pi-credit-card"},null,8,["loading"])])]),_:1}),t("div",ge,[t("div",be,[t("div",xe,[s(N,{header:"Total Amounts"},{default:l(()=>[t("div",Ce,[s(V,null,{default:l(()=>[s(p,null,{default:l(()=>e[4]||(e[4]=[r("USD")])),_:1,__:[4]}),s(b,{"default-value":D("USD"),readonly:"",placeholder:"0"},null,8,["default-value"]),s(p,null,{default:l(()=>e[5]||(e[5]=[r(".00")])),_:1,__:[5]})]),_:1}),s(V,null,{default:l(()=>[s(p,null,{default:l(()=>e[6]||(e[6]=[r("CAD")])),_:1,__:[6]}),s(b,{"default-value":D("CAD"),readonly:"",placeholder:"0"},null,8,["default-value"]),s(p,null,{default:l(()=>e[7]||(e[7]=[r(".00")])),_:1,__:[7]})]),_:1}),s(V,null,{default:l(()=>[s(p,null,{default:l(()=>e[8]||(e[8]=[r("GBP")])),_:1,__:[8]}),s(b,{"default-value":D("GBP"),readonly:"",placeholder:"0"},null,8,["default-value"]),s(p,null,{default:l(()=>e[9]||(e[9]=[r(".00")])),_:1,__:[9]})]),_:1})])]),_:1})]),t("div",De,[(m(!0),v(ne,null,ae(u.value,(o,A)=>(m(),P(N,{key:o.id},{header:l(()=>[t("div",Ve,[t("span",Ue,_(A+1)+". "+_(o.type)+" Gift Card ",1),s(d,{onClick:i=>u.value.splice(A,1),severity:"danger",text:"",rounded:"",icon:"pi pi-trash",size:"small"},null,8,["onClick"])])]),default:l(()=>[t("div",we,[t("div",ke,[e[10]||(e[10]=t("label",{class:"text-mute font-semibold text-sm"},[r(" Type "),t("span",{class:"text-red-500 font-medium"},"*")],-1)),s(G,{modelValue:o.type,"onUpdate:modelValue":i=>o.type=i,options:c(oe),fluid:""},null,8,["modelValue","onUpdate:modelValue","options"])]),t("div",Ne,[e[11]||(e[11]=t("label",{class:"text-mute font-semibold text-sm"},[r(" Country "),t("span",{class:"text-red-500 font-medium"},"*")],-1)),s(G,{modelValue:o.country,"onUpdate:modelValue":i=>o.country=i,options:c(le),fluid:"",onChange:()=>o.currency=B(o)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),t("div",Ge,[e[12]||(e[12]=t("label",{class:"text-mute font-semibold text-sm"},[r(" Gift Card Number "),t("span",{class:"text-red-500 font-medium"},"*")],-1)),s(S,{modelValue:o.cardNumber,"onUpdate:modelValue":i=>o.cardNumber=i,fluid:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Se,[e[13]||(e[13]=t("label",{class:"text-mute font-semibold text-sm"},[r(" Card PIN/Security Code "),t("span",{class:"text-red-500 font-medium"},"*")],-1)),s(S,{modelValue:o.pin,"onUpdate:modelValue":i=>o.pin=i,fluid:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",he,[e[14]||(e[14]=t("label",{class:"text-mute font-semibold text-sm"},[r(" Amount/Balance on Card "),t("span",{class:"text-red-500 font-medium"},"*")],-1)),s(b,{modelValue:o.amount,"onUpdate:modelValue":i=>o.amount=i,"max-fraction-digits":2,fluid:""},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024))),128)),t("button",{onClick:E,class:"cursor-pointer border-2 border-slate-300 hover:bg-slate-200 transition-colors border-dashed rounded-lg p-2 w-full h-32"},e[15]||(e[15]=[t("div",{class:"flex flex-col gap-2 text-slate-400"},[t("span",{class:"pi pi-plus-circle",style:{"font-size":"1.8rem"}}),t("span",{class:"font-semibold"},"Add Gift Card")],-1)]))])])]),s(T,{visible:g.value,"onUpdate:visible":e[0]||(e[0]=o=>g.value=o),modal:"",header:"Gift Card Deposit",class:"max-w-96"},{default:l(()=>[s(W,{error:c(k),class:"my-2"},null,8,["error"]),n.value?(m(),v("div",Te,[e[22]||(e[22]=t("p",{class:"text-slate-500 font-medium"},"Total Deposit Amount",-1)),t("p",Ae,_(c(Q).format(n.value.total)),1),n.value.rates.CAD||n.value.rates.GBP?(m(),v("div",Pe,[e[21]||(e[21]=r(" The total amount was calculated based on the following rates: ")),s(h),n.value.rates.CAD?(m(),v("div",Ie,[e[16]||(e[16]=t("span",{class:"font-medium"},"1 USD",-1)),e[17]||(e[17]=r(" = ")),t("span",$e,"CAD "+_(n.value.rates.CAD),1)])):x("",!0),n.value.rates.GBP?(m(),v("div",Be,[e[18]||(e[18]=t("span",{class:"font-medium"},"1 USD",-1)),e[19]||(e[19]=r(" = ")),t("span",Ee,"GBP "+_(n.value.rates.GBP),1)])):x("",!0),s(h),s(H,{size:"small"},{default:l(()=>e[20]||(e[20]=[r(" NOTE: The rates are subject to change based on market conditions and may vary at the time of deposit. ")])),_:1,__:[20]})])):x("",!0),s(d,{onClick:Y,loading:c(R),label:"Proceed with deposit request",icon:"pi pi-check-circle","icon-pos":"right",class:"mt-3"},null,8,["loading"])])):x("",!0)]),_:1},8,["visible"]),s(T,{visible:C.value,"onUpdate:visible":e[2]||(e[2]=o=>C.value=o),modal:"",header:"Deposit Request",class:"max-w-[90dvw] md:w-96 dark:bg-slate-900",closable:!1},{default:l(()=>[e[23]||(e[23]=t("div",{class:"flex flex-col items-center justify-center text-center"},[t("span",{class:"pi pi-check-circle text-emerald-500",style:{"font-size":"40px"}}),t("p",{class:"mt-4"},"Your deposit request has been received."),t("p",null,"Once confirmed, your account will be credited.")],-1)),t("div",qe,[s(d,{onClick:e[1]||(e[1]=o=>a.$router.push({name:"user-transactions"})),label:"Continue",fluid:""})])]),_:1,__:[23]},8,["visible"])]),_:1})}}});export{st as default};
