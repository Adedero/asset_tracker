import{_ as X}from"./vue-layout.vue_vue_type_script_setup_true_lang-Dd9kIAe8.js";import{d as Z,Y as ee,h as $,V as te,j as E,k as se,c as v,w as m,a as t,q as n,s as ae,v as l,b,e as re,N as oe,p as f,F as le,f as ne,x as ie,D as ue,o as u}from"./main-CE88ee4Q.js";import{s as de}from"./index-BGiSEDGv.js";import{s as ce}from"./index-DVAVs9ml.js";import{_ as me}from"./VCard.vue_vue_type_script_setup_true_lang-va0MW3Xd.js";import{s as pe}from"./index-BXAGMbEd.js";import{s as ve}from"./index-Drofbpnb.js";import{_ as fe}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-U_TlgEzX.js";import{_ as ge}from"./VNavbar.vue_vue_type_script_setup_true_lang-GcHfqelS.js";import{u as N}from"./use-fetch-CNl_4VEC.js";import"./index-wutX35Rh.js";import"./index-BPNPmUFq.js";import"./bundle-mjs-CLJs87Zn.js";import"./iconify-0_DS-cBL.js";const _e={class:"mt-2 md:h-[calc(100dvh-9rem)]"},xe={key:2,class:"h-full w-full"},ye={class:"h-full grid gap-2 items-start md:grid-cols-7 lg:grid-cols-5"},Ve={class:"max-h-full pb-5 overflow-y-auto grid gap-2 md:col-span-3 lg:col-span-2"},we={class:"grid gap-2"},be={class:"grid gap-1"},he={class:"grid gap-1"},Ce={class:"h-full pb-5 md:overflow-y-auto md:col-span-4 lg:col-span-3"},ke={class:"mt-2 grid gap-2"},Ae={class:"flex items-center justify-between gap-2 flex-wrap"},$e={class:"text-mute font-semibold"},Ne={class:"grid gap-2"},Se={class:"mt-2"},Ge={key:0,class:"w-full grid place-content-center gap-2"},Ue={key:2},De={class:"grid gap-2"},Je=Z({__name:"account-group-editor",setup(Fe){const h=te(),C=ee(),g=$(!1),i=h.currentRoute.value.params.account_group_id?h.currentRoute.value.params.account_group_id:void 0,{isFetching:T,data:d,error:_,execute:S}=N(()=>`/api/admins/me/pages/account-groups/${i}`,{immediate:!1}).get().json(),{isFetching:j,data:k,error:G,execute:U}=N("/api/admins/me/currencies",{immediate:!1}).get().json(),a=$({}),p=$(null),A=E({get(){var s,e;return(((s=d.value)==null?void 0:s.currencies)||((e=k.value)==null?void 0:e.currencies)||[]).filter(o=>{var x,y;return!((y=(x=a.value)==null?void 0:x.currencies)!=null&&y.find(V=>V.id===o.id))})},set(s){return s}}),B=s=>{const e=s.value;e&&p.value&&(p.value.id=e.id,p.value.name=e.name),g.value=!1,p.value=null};function R(s){p.value=s,g.value=!0}function z(){a.value.currencies=[...a.value.currencies||[],{id:"",name:"",walletAddress:"",walletAddressNetwork:""}]}function L(s){var e;a.value.currencies=(e=a.value.currencies)==null?void 0:e.filter(o=>o.id!==s)}const P=E(()=>{var s,e;return!a.value.name||!((s=a.value.currencies)!=null&&s.length)||((e=a.value.currencies)==null?void 0:e.some(o=>!o.id||!o.walletAddress))}),{isFetching:D,data:W,error:F,execute:M}=N(()=>i?`/api/admins/me/account-groups/${i}`:"/api/admins/me/account-groups",{immediate:!1})[i?"put":"post"](a).json(),I=async()=>{var o;const{valid:s,message:e}=Y();if(!s){C.add({severity:"error",summary:"Error",detail:e});return}if(await M(),F.value||!W.value){C.add({severity:"error",summary:"Error",detail:((o=F.value)==null?void 0:o.message)||"Failed to complete action. Try again later"});return}C.add({severity:"success",summary:"Success",detail:i?"Account group updated successfully":"Account group created successfully",life:2e3}),setTimeout(()=>{h.push({name:"admin-account-groups"})},2e3)};function Y(){var s,e;return a.value.name?(s=a.value.currencies)!=null&&s.length?(e=a.value.currencies)!=null&&e.some(o=>!o.id||!o.walletAddress)?{valid:!1,message:"All currencies must have a name and wallet address"}:{valid:!0,message:"Validation successful"}:{valid:!1,message:"At least one currency is required"}:{valid:!1,message:"Group name is required"}}return se(async()=>{if(!i){if(await U(),G.value||!k.value)return;A.value=k.value.currencies;return}await S(),!(_.value||!d.value)&&(a.value={...d.value.accountGroup,currencies:d.value.accountGroup.currencies.map(s=>{var e;return{...s,name:(e=d.value.currencies.find(o=>o.id===s.id))==null?void 0:e.name}})},A.value=[...d.value.currencies])}),(s,e)=>{const o=ae,x=ge,y=oe,V=fe,w=ve,H=pe,q=me,J=ce,K=de,O=ue,Q=X;return u(),v(Q,{name:"admin"},{default:m(()=>[t("div",null,[n(x,null,{right:m(()=>[n(o,{onClick:I,size:"small",label:l(i)?"Save":"Create",icon:l(i)?"pi pi-check":"pi pi-plus",loading:l(D),disabled:l(D)||P.value},null,8,["label","icon","loading","disabled"])]),_:1}),t("div",_e,[l(T)?(u(),v(y,{key:0})):l(_)?(u(),v(V,{key:1,error:l(_),"should-retry":"",onRetry:e[0]||(e[0]=r=>l(S)())},null,8,["error"])):l(i)&&l(d)||a.value?(u(),b("div",xe,[t("div",ye,[t("div",Ve,[n(q,{header:"Account Group"},{default:m(()=>[t("div",we,[t("div",be,[e[5]||(e[5]=t("span",{class:"text-sm font-medium text-slate-500"},[f(" Group Name "),t("span",{class:"text-xs font-medium text-red-500"},"(required)")],-1)),n(w,{modelValue:a.value.name,"onUpdate:modelValue":e[1]||(e[1]=r=>a.value.name=r),fluid:""},null,8,["modelValue"])]),t("div",he,[e[6]||(e[6]=t("span",{class:"text-sm font-medium text-slate-500"},[f(" Group Description "),t("span",{class:"text-xs font-medium text-primary-500"},"(optional)")],-1)),n(H,{modelValue:a.value.description,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.description=r),rows:"5","auto-resize":"",fluid:""},null,8,["modelValue"])])])]),_:1})]),t("div",Ce,[t("div",ke,[(u(!0),b(le,null,ne(a.value.currencies,r=>(u(),v(q,{header:r.name,class:"border"},{header:m(()=>[t("div",Ae,[t("p",$e,ie(r.name),1),n(o,{onClick:c=>L(r.id),text:"",size:"small",icon:"pi pi-trash",severity:"danger"},null,8,["onClick"])])]),default:m(()=>[t("div",Ne,[t("div",null,[e[7]||(e[7]=t("span",{class:"text-sm font-medium text-slate-500"},[f(" Currency "),t("span",{class:"text-xs font-medium text-red-500"},"(required)")],-1)),n(w,{onClick:c=>R(r),modelValue:r.name,"onUpdate:modelValue":c=>r.name=c,fluid:"",readonly:""},null,8,["onClick","modelValue","onUpdate:modelValue"])]),t("div",null,[e[8]||(e[8]=t("span",{class:"text-sm font-medium text-slate-500"},[f(" Wallet Address "),t("span",{class:"text-xs font-medium text-red-500"},"(required)")],-1)),n(w,{modelValue:r.walletAddress,"onUpdate:modelValue":c=>r.walletAddress=c,fluid:""},null,8,["modelValue","onUpdate:modelValue"])]),t("div",null,[e[9]||(e[9]=t("span",{class:"text-sm font-medium text-slate-500"},[f(" Wallet Address Network"),t("span",{class:"text-xs font-medium text-primary-500"},"(optional)")],-1)),n(w,{modelValue:r.walletAddressNetwork,"onUpdate:modelValue":c=>r.walletAddressNetwork=c,fluid:""},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["header"]))),256)),t("button",{onClick:z,type:"button",class:"cursor-pointer"},e[10]||(e[10]=[t("div",{class:"border-2 border-slate-300 rounded-lg border-dashed bg-slate-200 hover:bg-slate-50 transition-colors grid gap-1 place-content-center p-2 h-40"},[t("span",{class:"pi pi-plus-circle text-slate-500",style:{"font-size":"3rem"}}),t("p",{class:"text-center font-semibold text-slate-500"},"Add Currency")],-1)]))])])])])):re("",!0),n(O,{visible:g.value,"onUpdate:visible":e[4]||(e[4]=r=>g.value=r),class:"min-w-80 max-w-80",header:"Select Currency"},{default:m(()=>[t("div",Se,[l(j)?(u(),b("div",Ge,[n(J,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),e[11]||(e[11]=t("p",{class:"text-mute font-semibold text-sm"},"Loading currencies...",-1))])):l(G)?(u(),v(V,{key:1,error:l(_),"should-retry":"",onRetry:e[3]||(e[3]=r=>l(U)())},null,8,["error"])):(u(),b("div",Ue,[t("div",De,[e[12]||(e[12]=t("span",{class:"text-sm font-medium text-slate-500"}," Currencies ",-1)),n(K,{placeholder:"Select currency",onChange:B,options:A.value,"option-label":"name",checkmark:"",filter:""},null,8,["options"])])]))])]),_:1},8,["visible"])])])]),_:1})}}});export{Je as default};
