import{_ as et,s as st,a as nt}from"./vue-layout.vue_vue_type_script_setup_true_lang-BNFQYZFa.js";import{s as ot}from"./index-TDOKOudS.js";import{s as it}from"./index-DeLv1j-i.js";import{_ as rt}from"./VCard.vue_vue_type_script_setup_true_lang-7nJJ2y1E.js";import{s as lt}from"./index-FZwsz_b6.js";import{_ as dt}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-CPslCPqh.js";import{d as K,Y as Q,a1 as ct,aF as W,j as V,b as f,a,ah as F,q as s,s as ut,w as p,V as X,o as r,bv as mt,am as vt,h as ft,k as pt,i as gt,c as _,e as v,v as T,N as _t,x as D,F as H,f as J,p as A}from"./main-DbwiCszp.js";import{_ as ht}from"./VNavbar.vue_vue_type_script_setup_true_lang-VZ6PBI-e.js";import{_ as Ct}from"./transaction-status-manager.vue_vue_type_script_setup_true_lang-BtJgPlKx.js";import{u as Z}from"./use-fetch-CkegAda4.js";import"./index-BxwU-vK-.js";import"./index-55yS1M7a.js";import"./bundle-mjs-CLJs87Zn.js";import"./iconify-D-TZBpbX.js";import"./index-Hkmx9aLj.js";import"./index-CVVhXnti.js";const yt={class:"flex items-center gap-1"},xt=K({__name:"gift-card-validation-toolbar",props:{transaction:{}},emits:["discardChanges"],setup(d,{emit:h}){const $=h,k=X(),g=Q(),C=ct(),b=W("gift-card-transactions",[]),U=()=>{b.value.push(d.transaction),g.add({severity:"success",summary:"Success",detail:"Progress saved",life:3e3})},R=()=>{C.require({header:"Disacrd changes",message:"Do you want to discard all changes made to this transaction?",rejectProps:{label:"Cancel",severity:"secondary"},acceptProps:{label:"Proceed"},accept(){$("discardChanges")}})},P=V(()=>{var t;return{amountInUSD:d.transaction.amountInUSD,cards:(t=d.transaction.giftCardData)==null?void 0:t.cards}}),{isFetching:y,error:w,data:e,execute:B}=Z(()=>`/api/admins/me/transactions/${d.transaction.id}/approve`,{immediate:!1}).put(P).json();async function E(){var i;const{valid:t,message:o}=G();if(!t){g.add({severity:"error",summary:"Error",detail:o,life:3e3});return}if(await B(),w.value||!e.value){g.add({severity:"error",summary:"Error",detail:(i=w.value)==null?void 0:i.message});return}setTimeout(()=>{k.push({name:"admin-transaction-item",params:{transaction_id:d.transaction.id}})},3e3),g.add({severity:"success",summary:"Success",detail:e.value.message||"Transaction marked as approved",life:3e3})}function G(){var t;return d.transaction.transactionStatus!=="PENDING"?{valid:!1,message:"Transaction status has already been resolved"}:d.transaction.transactionType!=="DEPOSIT"?{valid:!1,message:"Only deposit transactions can be modified"}:d.transaction.amountInUSD?(t=d.transaction.giftCardData)!=null&&t.cards.some(o=>!o.amountRetrieved)?{valid:!1,message:"One or more cards have not been validated. Validate all cards and try again"}:{valid:!0,message:"Validation successful"}:{valid:!1,message:"Transaction amount is not set"}}const q=()=>{C.require({header:"Approve transaction",message:"Do you want to approve this transaction?",rejectProps:{label:"Cancel",severity:"secondary"},acceptProps:{label:"Approve"},accept(){E()}})},n=()=>{k.push({name:"admin-transaction-item",params:{transaction_id:d.transaction.id}})};return(t,o)=>{const i=ut,m=Ct,c=mt;return r(),f("div",null,[a("div",yt,[F(s(i,{onClick:U,icon:"pi pi-save",size:"small",outlined:""},null,512),[[c,"Save progress"]]),F(s(i,{onClick:o[0]||(o[0]=u=>R()),icon:"pi pi-refresh",size:"small",outlined:""},null,512),[[c,"Discard changes"]]),s(m,{onUpdate:n,transaction:t.transaction,action:"fail"},{default:p(()=>[F(s(i,{icon:"pi pi-times-circle",size:"small",outlined:""},null,512),[[c,"Fail transaction"]])]),_:1},8,["transaction"]),F(s(i,{onClick:o[1]||(o[1]=u=>q()),label:"Approve",icon:"pi pi-check-circle",size:"small"},null,512),[[c,"Approve transaction"]])])])}}}),Dt={class:"mt-2 md:h-[calc(100dvh-9rem)]"},bt={key:2,class:"h-full w-full"},St={class:"h-full grid gap-2 items-start md:grid-cols-7 lg:grid-cols-5"},Tt={class:"max-h-full pb-5 overflow-y-auto grid gap-2 md:col-span-3 lg:col-span-2"},At={class:"text-right"},Vt={class:"text-2xl font-semibold text-emerald-500"},$t={class:"text-right"},kt={class:"text-2xl font-semibold text-emerald-500"},Ut={class:"my-2 text-mute grid gap-1"},Pt={key:0},wt={class:"text-sm text-slate-500"},Bt={key:0},Gt={class:"font-semibold"},It={key:1},Nt={class:"font-semibold"},Ft={key:0,class:"h-full pb-5 md:overflow-y-auto md:col-span-4 lg:col-span-3"},Rt={class:"text-right text-3xl font-semibold"},Et={class:"mt-2 grid gap-2"},qt={class:"grid gap-2 md:grid-cols-6"},Lt={class:"md:col-span-3"},jt={class:"md:col-span-3"},zt={class:"md:col-span-6"},Mt={class:"md:col-span-3"},Ot={class:"md:col-span-3"},Yt={class:"md:col-span-3"},Ht={class:"md:col-span-3"},ca=K({__name:"gift-card-validate",async setup(d){let h,$;const k=X(),g=Q(),{transaction_id:C}=k.currentRoute.value.params,b=W("gift-card-transactions",[]),U=V(()=>b.value.find(n=>n.id===C)),{isFetching:R,error:P,data:y,execute:w}=([h,$]=vt(()=>Z(()=>`/api/admins/me/transactions/${C}`).get().json()),h=await h,$(),h),e=ft(null);pt(()=>{y.value&&(U.value&&g.add({severity:"success",summary:"Transaction loaded from drafts",detail:"You can now continue from where you left off.",life:3e3}),e.value={...structuredClone(y.value.transaction),amountInUSD:0,...structuredClone(U.value)})});const B=V(()=>{var n,t;return((t=(n=e.value)==null?void 0:n.giftCardData)==null?void 0:t.cards.reduce((o,i)=>o+(i.amountRetrieved||0),0))||0});gt(B,n=>{e.value&&(e.value.amountInUSD=n)},{immediate:!0});const E=V(()=>{var n,t,o,i;return((t=(n=e.value)==null?void 0:n.giftCardData)==null?void 0:t.totalInUSD)||((i=(o=e.value)==null?void 0:o.giftCardData)==null?void 0:i.cards.reduce((m,c)=>m+c.amount,0))||0}),G=V(()=>{var n,t,o,i,m,c;return{USD:((t=(n=e.value)==null?void 0:n.giftCardData)==null?void 0:t.cards.filter(u=>u.currency==="USD").length)||0,CAD:((i=(o=e.value)==null?void 0:o.giftCardData)==null?void 0:i.cards.filter(u=>u.currency==="CAD").length)||0,GBP:((c=(m=e.value)==null?void 0:m.giftCardData)==null?void 0:c.cards.filter(u=>u.currency==="GBP").length)||0}}),q=()=>{var n;(n=y.value)!=null&&n.transaction&&(b.value=b.value.filter(t=>t.id!==C),e.value=structuredClone(y.value.transaction),g.add({severity:"info",summary:"Changes discarded",life:3e3}))};return(n,t)=>{const o=xt,i=ht,m=_t,c=dt,u=lt,I=rt,j=st,tt=nt,S=it,z=ot,at=et;return r(),_(at,{name:"admin"},{default:p(()=>[a("div",null,[s(i,null,{right:p(()=>[e.value?(r(),_(o,{key:0,transaction:e.value,onDiscardChanges:q},null,8,["transaction"])):v("",!0)]),_:1}),a("div",Dt,[T(R)?(r(),_(m,{key:0})):T(P)?(r(),_(c,{key:1,error:T(P),"should-retry":"",onRetry:t[0]||(t[0]=l=>T(w)())},null,8,["error"])):T(y)&&e.value?(r(),f("div",bt,[a("div",St,[a("div",Tt,[s(I,{header:"Actual Amount From Gift Cards"},{default:p(()=>[a("div",At,[s(u,{value:"$"}),a("p",Vt,D(B.value.toLocaleString()),1)])]),_:1}),s(I,{header:"Expected Amount"},{default:p(()=>{var l,N,x,M,O,Y;return[a("div",$t,[s(u,{value:"$"}),a("p",kt,D(E.value.toLocaleString()),1)]),a("div",Ut,[t[1]||(t[1]=a("span",{class:"text-sm"},"From: ",-1)),(r(),f(H,null,J(["USD","CAD","GBP"],L=>a("div",null,[G.value[L]?(r(),f("div",Pt,[A(D(L)+" Gift Cards: ",1),s(u,{value:G.value[L]},null,8,["value"])])):v("",!0)])),64))]),(l=e.value.giftCardData)!=null&&l.rates.CAD||(N=e.value.giftCardData)!=null&&N.rates.GBP?(r(),_(j,{key:0})):v("",!0),a("div",wt,[(x=e.value.giftCardData)!=null&&x.rates.CAD?(r(),f("div",Bt,[t[2]||(t[2]=a("span",{class:"font-medium"},"1 USD",-1)),t[3]||(t[3]=A(" = ")),a("span",Gt," CAD "+D(e.value.giftCardData.rates.CAD),1)])):v("",!0),(M=e.value.giftCardData)!=null&&M.rates.GBP?(r(),f("div",It,[t[4]||(t[4]=a("span",{class:"font-medium"},"1 USD",-1)),t[5]||(t[5]=A(" = ")),a("span",Nt," GBP "+D(e.value.giftCardData.rates.GBP),1)])):v("",!0)]),(O=e.value.giftCardData)!=null&&O.rates.CAD||(Y=e.value.giftCardData)!=null&&Y.rates.GBP?(r(),_(j,{key:1})):v("",!0),s(tt,{size:"small"},{default:p(()=>t[6]||(t[6]=[a("p",{class:"text-xs leading-4"}," This amount was calculated based on the rates at the time the deposit request was made. It may not be the same with the actual amount retrieved from the gift card due to fluctuations in market prices and other charges. ",-1)])),_:1,__:[6]})]}),_:1})]),e.value.giftCardData?(r(),f("div",Ft,[s(I,{header:"Total Gift Cards"},{default:p(()=>[a("p",Rt,D(e.value.giftCardData.cards.length),1)]),_:1}),a("div",Et,[(r(!0),f(H,null,J(e.value.giftCardData.cards,(l,N)=>(r(),_(I,{header:`${N+1}. ${l.currency} Card`,class:"border"},{default:p(()=>[a("div",qt,[a("div",Lt,[t[7]||(t[7]=a("span",{class:"text-sm font-medium text-slate-500"},"Type",-1)),s(S,{value:l.type,fluid:"",disabled:""},null,8,["value"])]),a("div",jt,[t[8]||(t[8]=a("span",{class:"text-sm font-medium text-slate-500"},"Country",-1)),s(S,{value:l.country,fluid:"",disabled:""},null,8,["value"])]),a("div",zt,[t[9]||(t[9]=a("span",{class:"text-sm font-medium text-slate-500"},"Card Number",-1)),s(S,{value:l.cardNumber,fluid:"",disabled:""},null,8,["value"])]),a("div",Mt,[t[10]||(t[10]=a("span",{class:"text-sm font-medium text-slate-500"},"PIN/Security Code",-1)),s(S,{value:l.pin,fluid:"",disabled:""},null,8,["value"])]),a("div",Ot,[t[11]||(t[11]=a("span",{class:"text-sm font-medium text-slate-500"},"Amount/Balance",-1)),s(S,{value:l.amount,fluid:"",disabled:""},null,8,["value"])]),a("div",Yt,[t[12]||(t[12]=a("span",{class:"text-sm font-medium text-slate-500"},[A(" Amount Retrieved "),a("span",{class:"text-red-500 text-xs"},"required")],-1)),s(z,{modelValue:l.amountRetrieved,"onUpdate:modelValue":x=>l.amountRetrieved=x,"max-fraction-digits":2,fluid:""},null,8,["modelValue","onUpdate:modelValue"])]),a("div",Ht,[t[13]||(t[13]=a("span",{class:"text-sm font-medium text-slate-500"},[A(" Rate Used "),a("span",{class:"text-primary-500 text-xs"},"optional")],-1)),s(z,{modelValue:l.rateUsed,"onUpdate:modelValue":x=>l.rateUsed=x,"use-grouping":!1,"max-fraction-digits":25,fluid:""},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["header"]))),256))])])):v("",!0)])])):v("",!0)])])]),_:1})}}});export{ca as default};
