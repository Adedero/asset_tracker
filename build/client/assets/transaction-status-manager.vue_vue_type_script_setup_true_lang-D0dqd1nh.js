import{d as W,Y as j,h as k,b as d,a as t,q as u,r as G,c as y,e as c,s as O,v as l,D as Y,w as H,p as i,n as M,x as o,V as J,o as n}from"./main-CE88ee4Q.js";import{s as K}from"./index-BXAGMbEd.js";import{s as Q}from"./index-B88Wmsvc.js";import{_ as X}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-U_TlgEzX.js";import{t as R}from"./vue-layout.vue_vue_type_script_setup_true_lang-Dd9kIAe8.js";import{u as N}from"./use-fetch-CNl_4VEC.js";const Z={key:0,class:"mt-2 border rounded-lg p-2 flex items-start gap-2"},x={class:"text-sm text-mute"},_={key:0},aa={class:"font-semibold"},ea={key:1},ta={class:"font-semibold"},sa={class:"font-semibold"},na={key:2},ia={class:"font-semibold"},oa={class:"font-semibold"},la={class:"font-semibold"},ra={key:1,class:"mt-2"},da={class:"mt-4 flex items-center justify-end gap-2"},ya=W({__name:"transaction-status-manager",props:{transaction:{},action:{}},emits:["update"],setup(s,{emit:E}){const w=E,A=J(),g=j(),m=k(!1),v=k(!1),r=k({failReason:""}),{isFetching:h,error:C,data:b,execute:P}=N(()=>`/api/admins/me/transactions/${s.transaction.id}/approve`,{immediate:!1}).put().json(),{isFetching:D,error:$,data:T,execute:U}=N(()=>`/api/admins/me/transactions/${s.transaction.id}/fail`,{immediate:!1}).put(r).json();async function I(){const{valid:e,message:a}=F();if(!e){g.add({severity:"error",summary:"Failed",detail:a,life:6e3});return}s.action==="approve"&&await P(),s.action==="fail"&&await U(),!(C.value||$.value)&&(b.value&&(w("update",b.value.transaction),g.add({severity:"success",summary:"Done",detail:b.value.message||"Transaction status updated successfully",life:3e3})),T.value&&(w("update",T.value.transaction),g.add({severity:"success",summary:"Done",detail:T.value.message||"Transaction status updated successfully",life:3e3})),S())}function F(){return s.transaction.transactionStatus!=="PENDING"?{valid:!1,message:"Transaction status has already been resolved"}:s.transaction.transactionType!=="DEPOSIT"&&s.transaction.transactionType!=="WITHDRAWAL"?{valid:!1,message:"Only deposit or withdrawal transactions can be modified"}:s.action==="approve"&&!m.value?{valid:!1,message:"Please, confirm the action"}:s.action==="fail"&&!r.value.failReason?{valid:!1,message:"No reason for failure provided"}:{valid:!0,messsage:"Validation successful"}}async function q(){s.transaction.transactionStatus==="PENDING"&&s.action==="approve"&&s.transaction.isGiftCard?await A.push({name:"admin-gift-card-validate",params:{transaction_id:s.transaction.id}}):v.value=!0}function S(){m.value=!1,v.value=!1,r.value.failReason=""}return(e,a)=>{const f=O,V=X,B=Q,z=K,L=Y;return n(),d("div",null,[t("div",{onClick:q,class:"cursor-pointer"},[G(e.$slots,"default",{action:e.action},()=>[e.action==="approve"?(n(),y(f,{key:0,label:`Approve ${l(R)(e.transaction.transactionType)}`,icon:"pi pi-chevron-right","icon-pos":"right",size:"small",fluid:""},null,8,["label"])):c("",!0),e.action==="fail"?(n(),y(f,{key:1,label:`Fail ${l(R)(e.transaction.transactionType)}`,icon:"pi pi-chevron-right","icon-pos":"right",size:"small",fluid:"",severity:"danger"},null,8,["label"])):c("",!0)])]),u(L,{visible:v.value,"onUpdate:visible":a[2]||(a[2]=p=>v.value=p),modal:"",header:"Update Transaction Status",class:"w-full max-w-96"},{default:H(()=>[t("div",null,[u(V,{error:l(C),class:"mt-2"},null,8,["error"]),u(V,{error:l($),class:"mt-2"},null,8,["error"]),t("p",null,[a[3]||(a[3]=i(" You are about to ")),t("span",{class:M(`font-semibold ${e.action==="fail"?"text-red-500":"text-green-500"}`)},o(e.action),3),i(" this "+o(e.transaction.transactionType)+" transaction and this cannot be undone. Are you sure you want to proceed? ",1)]),e.action==="approve"?(n(),d("div",Z,[u(B,{binary:"",modelValue:m.value,"onUpdate:modelValue":a[0]||(a[0]=p=>m.value=p)},null,8,["modelValue"]),t("p",x,[e.transaction.isWireTransfer?(n(),d("span",_,[a[4]||(a[4]=i(" I have received ")),t("span",aa," $"+o(e.transaction.amountInUSD.toLocaleString()),1),a[5]||(a[5]=i(" from the client via wire transfer. "))])):e.transaction.transactionType==="DEPOSIT"?(n(),d("span",ea,[a[6]||(a[6]=i(" I have received ")),t("span",ta,o(e.transaction.amountInCurrency)+" "+o(e.transaction.currency),1),a[7]||(a[7]=i(", ")),a[8]||(a[8]=t("span",null,"the equivalent of ",-1)),t("span",sa," $"+o(e.transaction.amountInUSD.toLocaleString()),1),a[9]||(a[9]=t("span",null," from the client via cryptocurrency deposit to my wallet address. ",-1))])):(n(),d("span",na,[a[10]||(a[10]=i(" I have sent ")),t("span",ia,o(`${e.transaction.amountInCurrency} ${e.transaction.currency}`),1),a[11]||(a[11]=i(", the equivalent of ")),t("span",oa," $"+o(e.transaction.actualAmountInUSD.toLocaleString()),1),a[12]||(a[12]=t("span",null," to the client's wallet address: ",-1)),t("span",la,o(e.transaction.withdrawalWalletAddress),1)]))])])):c("",!0),e.action==="fail"?(n(),d("div",ra,[a[13]||(a[13]=t("p",{class:"text-sm text-mute font-medium"},[i(" Reason for transaction failure "),t("span",{class:"text-red-500"},"*")],-1)),u(z,{modelValue:r.value.failReason,"onUpdate:modelValue":a[1]||(a[1]=p=>r.value.failReason=p),rows:"4",class:"resize-none",fluid:""},null,8,["modelValue"])])):c("",!0),t("div",da,[u(f,{onClick:S,label:"Cancel",severity:"secondary"}),e.action==="approve"?(n(),y(f,{key:0,onClick:I,loading:l(h),disabled:l(h)||!m.value,label:"Proceed",severity:"primary"},null,8,["loading","disabled"])):c("",!0),e.action==="fail"?(n(),y(f,{key:1,onClick:I,loading:l(D),disabled:l(D)||!r.value.failReason,label:"Proceed",severity:"danger"},null,8,["loading","disabled"])):c("",!0)])])]),_:1},8,["visible"])])}}});export{ya as _};
