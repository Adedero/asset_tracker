import{_ as q,s as G}from"./vue-layout.vue_vue_type_script_setup_true_lang-Dd9kIAe8.js";import{_ as Q}from"./VPaginator.vue_vue_type_script_setup_true_lang-d1R-1bBh.js";import{s as X}from"./index-Cf5x4JsD.js";import{_ as H}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-U_TlgEzX.js";import{d as J,Y as K,a1 as O,h as D,j as m,X as Z,c as g,w as d,a as o,q as n,b as p,e as C,s as ee,v as a,N as te,F as se,f as ae,x as v,U as oe,ah as ie,ap as ne,o as c}from"./main-CE88ee4Q.js";import{_ as re}from"./VCard.vue_vue_type_script_setup_true_lang-va0MW3Xd.js";import{s as le}from"./index-DVAVs9ml.js";import{_ as ce}from"./VNavbar.vue_vue_type_script_setup_true_lang-GcHfqelS.js";import{u as de,$ as ue}from"./use-fetch-CNl_4VEC.js";import{u as me}from"./use-swrv-ttgJgnvy.js";import"./bundle-mjs-CLJs87Zn.js";import"./iconify-0_DS-cBL.js";const pe={key:0,class:"left-0 top-0 z-[100] fixed w-dvw h-dvh flex items-center justify-center bg-black/60 backdrop-blur-lg"},fe={class:"mt-2 flex flex-col w-full items-center justify-center gap-4"},_e={key:2,class:"w-full mt-2"},ge={key:3,class:"mt-2 py-2 flex flex-col gap-2 *:flex-shrink-0 md:h-[calc(100dvh-8.5rem)] overflow-y-auto items-center"},ve={class:"flex items-center gap-1"},he={class:"font-semibold"},ye={class:"text-sm whitespace-pre-wrap"},we={class:"flex items-center gap-1 justify-between"},xe={class:"flex items-center gap-2"},Me=J({__name:"notifications",setup($e){const h=K(),S=O(),f=D(0),u=Z,A=m(()=>{const e=new URLSearchParams;return e.set("take",u.toString()),e.set("skip",(f.value*u).toString()),e.set("sort","createdAt,desc"),e.toString()}),{isLoading:P,data:i,error:y,mutate:w}=me(()=>`/api/users/me/notifications?${A.value}`,ue),N=m(()=>{var e;return((e=i.value)==null?void 0:e.notifications.length)||0}),V=m(()=>{var e;return!!((e=i.value)!=null&&e.notifications)&&i.value.notifications.length<u}),r=D([]),x=m(()=>{const e="/api/users/me/notifications";if(!r.value.length)return`${e}/ALL`;const s=r.value.toString();return`${e}/${s}`}),{isFetching:_,error:$,data:k,execute:E}=de(x,{immediate:!1}).delete().json(),T=async()=>{if(!i.value)return;if(r.value.length&&i.value.notifications.filter(l=>r.value.includes(l.id)).forEach(l=>l.isLoading=_.value),await E(),$.value||!k.value){h.add({severity:"error",summary:"Error",detail:$.value.message});return}const{deleteCount:e}=k.value,s=r.value.length?i.value.notifications.filter(l=>!r.value.includes(l.id)):[];await w(()=>Promise.resolve({success:!0,message:"Notifications updated successfully.",notifications:s})),h.add({severity:"success",detail:`${e} ${e===0||e>1?"notifications":"notification"} deleted.`})},j=()=>{r.value=[],L()},M=e=>{r.value=[e.id],L()};function L(){S.require({message:"Are you sure you want to proceed?",header:"Delete notification",icon:"pi pi-exclamation-triangle",rejectProps:{label:"Cancel",severity:"secondary",outlined:!0},acceptProps:{label:"Proceed",severity:"danger"},accept:()=>{T()}})}return(e,s)=>{const l=ee,B=ce,F=le,b=re,I=te,R=H,U=G,Y=X,z=Q,W=q;return c(),g(W,{name:"user"},{default:d(()=>[o("div",null,[n(B,null,{right:d(()=>{var t;return[n(l,{onClick:j,disabled:!((t=a(i))!=null&&t.notifications.length),loading:a(_),label:"Clear All",severity:"danger",icon:"pi pi-trash",size:"small"},null,8,["disabled","loading"])]}),_:1}),x.value.endsWith("ALL")&&a(_)?(c(),p("div",pe,[n(b,{header:"Updating",class:"w-60 shadow-lg"},{default:d(()=>[o("div",fe,[n(F,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"transparent",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),s[2]||(s[2]=o("p",{class:"text-mute font-semibold text-sm"},"Please wait...",-1))])]),_:1})])):C("",!0),a(P)?(c(),g(I,{key:1})):a(y)?(c(),p("div",_e,[n(R,{error:a(y),"should-retry":"",onRetry:s[0]||(s[0]=t=>a(w)())},null,8,["error"])])):a(i)?(c(),p("div",ge,[(c(!0),p(se,null,ae(a(i).notifications,t=>(c(),g(b,{key:t.id,class:"w-full max-w-[32rem]"},{header:d(()=>[o("div",ve,[s[3]||(s[3]=o("span",{class:"pi pi-info-circle"},null,-1)),o("p",he,v(t.title),1)])]),default:d(()=>[o("p",ye,v(t.description),1),n(U,{class:"py-1"}),o("div",we,[o("small",null,v(a(oe)(t.createdAt,"MMM DD, YYYY hh:mm AA")),1),o("div",xe,[ie(n(Y,{value:"new",severity:"warn",class:"text-xs"},null,512),[[ne,!t.isRead]]),n(l,{onClick:ke=>M(t),loading:t.isLoading,size:"small",severity:"danger",rounded:"",text:"",icon:"pi pi-trash"},null,8,["onClick","loading"])])])]),_:2},1024))),128)),n(z,{length:N.value,allLoaded:V.value,rows:a(u),page:f.value,"onUpdate:page":s[1]||(s[1]=t=>f.value=t)},null,8,["length","allLoaded","rows","page"])])):C("",!0)])]),_:1})}}});export{Me as default};
