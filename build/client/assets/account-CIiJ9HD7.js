import{a as oe,_ as ie,c as ne,s as re,t as ue,e as de}from"./vue-layout.vue_vue_type_script_setup_true_lang-Dd9kIAe8.js";import{d as j,O as T,P as F,h as v,c as D,D as B,w as d,a as e,q as l,p as me,x as f,v as t,A as ce,o as u,Q as pe,b as V,e as $,s as Y,R as fe,y as ve,j as _e,T as ge,N as ye,t as be,U as xe,V as ke}from"./main-CE88ee4Q.js";import{_ as q}from"./VFileUploader.vue_vue_type_script_setup_true_lang-DHTQRJoi.js";import{s as K}from"./index-BGiSEDGv.js";import{_ as L}from"./VErrorMessage.vue_vue_type_script_setup_true_lang-U_TlgEzX.js";import{u as G,$ as he}from"./use-fetch-CNl_4VEC.js";import{s as we}from"./index-Cf5x4JsD.js";import{_ as Ve}from"./VCard.vue_vue_type_script_setup_true_lang-va0MW3Xd.js";import{s as O}from"./index-Drofbpnb.js";import{c as $e}from"./country-by-name-Di7sd6fA.js";import{I as R}from"./iconify-0_DS-cBL.js";import{_ as De}from"./VNavbar.vue_vue_type_script_setup_true_lang-GcHfqelS.js";import{u as Ue}from"./use-swrv-ttgJgnvy.js";import{o as Ee,s as Ie}from"./types-CPE1WPKY.js";import"./index-wutX35Rh.js";import"./index-BPNPmUFq.js";import"./bundle-mjs-CLJs87Zn.js";const Se={class:"grid gap-4"},Ne={class:"grid gap-2"},Ce={class:"grid gap-2"},ze=j({__name:"kyc-verifier",props:{visible:{type:Boolean,default:!1},visibleModifiers:{}},emits:T(["update"],["update:visible"]),setup(_,{emit:N}){const a=N,g=F(_,"visible"),U=v(["International Passport","Driver's License","Voter's Card","National ID Card"]),o=v(),y=v({kycIdType:o.value,kycDocument:void 0,kycDocumentExt:void 0,kycStatus:"PENDING",kycSubmittedAt:void 0,kycVerifiedAt:void 0}),{isFetching:I,error:h,execute:b}=G(()=>"/api/users/me/account",{immediate:!1}).put(y).json(),E=async m=>{const n=m[0];y.value={kycIdType:o.value,kycDocument:n.dataUrl,kycDocumentExt:n.name.split(".").pop(),kycStatus:"PENDING",kycSubmittedAt:new Date,kycVerifiedAt:void 0},await b().then(()=>{h.value||(g.value=!1,a("update",y.value))})};return(m,n)=>{const c=oe,i=L,S=K,C=q,z=B;return u(),D(z,{visible:g.value,"onUpdate:visible":n[1]||(n[1]=x=>g.value=x),header:"KYC Verification",modal:"",class:"w-full max-w-96"},{default:d(()=>[e("div",Se,[l(c,{size:"small",class:"mt-2"},{default:d(()=>[me(" For a quicker verification process, please make sure the name on your ID matches your name on "+f(t(ce))+". ",1)]),_:1}),l(i,{error:t(h),class:"my-3"},null,8,["error"]),e("div",Ne,[n[2]||(n[2]=e("label",{for:"id-type",class:"text-mute text-sm font-medium"},"ID Type",-1)),l(S,{"label-id":"id-type",modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=x=>o.value=x),options:U.value},null,8,["modelValue","options"])]),e("div",Ce,[n[3]||(n[3]=e("label",{for:"kyc-document",class:"text-mute text-sm font-medium"},"Upload Document",-1)),n[4]||(n[4]=e("small",{class:"text-primary-500"},"Uploaded file must be 2 MB or less",-1)),l(C,{"input-id":"kyc-document","max-file-size":2*1024*1024,disabled:t(I)||!o.value,onUpload:E,loading:t(I)},null,8,["disabled","loading"])])])]),_:1},8,["visible"])}}}),Pe={key:0},Me={class:"grid gap-4"},Te={class:"flex flex-col gap-2 items-center"},Re={class:"w-24 aspect-square rounded-full bg-slate-100 dark:bg-slate-800 overflow-hidden"},je=["src","alt"],Be={class:"my-2 w-full"},Le={class:"grid gap-2"},Ae={class:"grid gap-2"},Fe={class:"grid gap-2"},Ye={class:"grid gap-2"},qe={class:"grid gap-2"},Ke=j({__name:"user-profile-editor",props:T({user:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:T(["update"],["update:visible"]),setup(_,{emit:N}){const a=pe(),g=F(_,"visible"),U=N,o=v({name:_.user.name,address:_.user.address||"",phoneNumber:_.user.phoneNumber||"",country:_.user.country||"",region:_.user.region||"",image:_.user.image||""}),y=v(o.value.country?{country:o.value.country}:null),I=c=>{o.value.image=c[0].dataUrl||""},{isFetching:h,error:b,execute:E}=G(()=>"/api/users/me",{immediate:!1}).put(o).json(),m=async()=>{var c;o.value.name&&((c=y.value)!=null&&c.country&&(o.value.country=y.value.country),await E().then(()=>{b.value||(a.user.name=o.value.name,a.user.image=o.value.image||"",g.value=!1,U("update",o.value))}))},n=()=>{o.value={...o.value,image:""},m()};return(c,i)=>{const S=Y,C=q,z=L,x=O,k=K,s=B;return u(),V("div",null,[l(s,{visible:g.value,"onUpdate:visible":i[6]||(i[6]=r=>g.value=r),header:"Edit Details",modal:"",class:"w-full max-w-96"},{default:d(()=>[c.user?(u(),V("div",Pe,[e("div",Me,[e("div",Te,[e("div",Re,[o.value.image?(u(),V("img",{key:0,src:o.value.image,alt:o.value.name,class:"w-full h-full object-cover"},null,8,je)):$("",!0),l(t(R),{icon:"ic:baseline-account-circle",style:{"font-size":"96px"}})]),c.user.image?(u(),D(S,{key:0,label:"Remove image",onClick:n})):(u(),D(C,{key:1,size:"small",accept:"image/*","max-file-size":t(fe),onSelect:I,onCancel:i[0]||(i[0]=r=>o.value.image=""),onUpload:m,loading:t(h)},null,8,["max-file-size","loading"]))]),e("div",Be,[t(b)?(u(),D(z,{key:0,error:t(b)},null,8,["error"])):$("",!0)]),e("div",Le,[i[7]||(i[7]=e("label",{for:"name",class:"text-mute text-sm font- medium"},"Name",-1)),l(x,{id:"name",modelValue:o.value.name,"onUpdate:modelValue":i[1]||(i[1]=r=>o.value.name=r)},null,8,["modelValue"])]),e("div",Ae,[i[8]||(i[8]=e("label",{for:"phone-number",class:"text-mute text-sm font- medium"},"Phone Number",-1)),l(x,{id:"phone-number",modelValue:o.value.phoneNumber,"onUpdate:modelValue":i[2]||(i[2]=r=>o.value.phoneNumber=r)},null,8,["modelValue"])]),e("div",Fe,[i[9]||(i[9]=e("label",{for:"name",class:"text-mute text-sm font- medium"},"House Address",-1)),l(x,{id:"address",modelValue:o.value.address,"onUpdate:modelValue":i[3]||(i[3]=r=>o.value.address=r)},null,8,["modelValue"])]),e("div",Ye,[i[10]||(i[10]=e("label",{for:"country",class:"text-mute text-sm font- medium"},"Country",-1)),l(k,{modelValue:y.value,"onUpdate:modelValue":i[4]||(i[4]=r=>y.value=r),options:t($e),editable:"","option-label":"country",fluid:"","show-clear":""},null,8,["modelValue","options"])]),e("div",qe,[i[11]||(i[11]=e("label",{for:"region",class:"text-mute text-sm font- medium"},"State/Region",-1)),l(x,{id:"name",modelValue:o.value.region,"onUpdate:modelValue":i[5]||(i[5]=r=>o.value.region=r)},null,8,["modelValue"])]),e("div",null,[l(S,{onClick:m,label:"Submit",fluid:"",icon:"pi pi-check",disabled:t(h)||!o.value.name},null,8,["disabled"])])])])):$("",!0)]),_:1},8,["visible"])])}}}),Ge={class:"h-full"},Oe={class:"mt-2 overflow-y-auto md:h-[calc(100dvh-8rem)]"},We={key:1},He={key:2,class:"w-full h-full grid gap-2 md:grid-cols-7"},Qe={class:"md:col-span-4 grid gap-2"},Xe={class:"flex items-center justify-end gap-2"},Ze={class:"grid gap-1"},Je={key:0,class:"text-red-500"},es={class:"mt-2 flex items-center flex-col md:flex-row justify-center md:justify-normal gap-5 flex-wrap"},ss={key:0,class:"bg-white rounded-full w-36 md:w-28 aspect-square overflow-hidden"},ts=["src","alt"],ls={class:"font-semibold text-4xl md:5xl"},as={class:"flex flex-col gap-2 *:flex-shrink-0"},os={class:"v-card !p-2 border dark:border-white/30 dark:bg-slate-800"},is={class:"text-right font-semibold"},ns={class:"v-card !p-2 border dark:border-white/30 dark:bg-slate-800"},rs={class:"text-right font-semibold"},us={class:"v-card !p-2 border dark:border-white/30 dark:bg-slate-800"},ds={class:"text-right font-semibold"},ms={class:"md:col-span-3 md:row-span-6 flex flex-col gap-2 *:flex-shrink-0"},cs={class:"flex items-center gap-1"},ps={class:"mt-2"},fs={class:"text-3xl md:text-34xl font-semibold"},vs={class:"text-xl"},_s={class:"mt-3 flex items-center justify-end gap-2"},gs={class:"p-2 border rounded-lg dark:border-white/30 dark:bg-slate-800"},ys={class:"mt-3 flex items-center gap-2 justify-between"},bs={key:0,class:"mt-4"},xs={class:"p-2 border rounded-lg dark:border-white/30 dark:bg-slate-800"},ks={class:"mt-3 grid gap-2"},hs={class:"flex items-center justify-between gap-3 flex-wrap"},ws={key:0,class:"flex items-center justify-between gap-3 flex-wrap"},Vs={class:"flex items-center gap-2 flex-wrap justify-between"},$s=["href","download"],Ys=j({__name:"account",setup(_){const{isLoading:N,data:a,error:g,mutate:U}=Ue(()=>"/api/users/me/account",he),o=async k=>{await U(()=>{var s;return Promise.resolve({success:!0,message:"User updated successfully.",user:{...(s=a.value)==null?void 0:s.user,...k}})})},y=ke(),I=ve(),h=v(I.query["edit-profile"]==="true"),b=v(!1),E=v(!1),m=v(""),n=_e(()=>{var k;return!!m.value&&m.value===((k=a.value)==null?void 0:k.user.email)}),c=v(""),i=ge("menu"),S=v([{label:"Edit email address",icon:"pi pi-at",command:()=>E.value=!0},{label:"Edit other details",icon:"pi pi-user-edit",command:()=>h.value=!0}]),C=()=>{var r;if(c.value="",!((r=a.value)!=null&&r.user)||!m.value||n.value)return;const s=Ee({email:Ie({message:"Email is required"}).email({message:"Enter a valid email"})}).safeParse({email:m.value});if(!s.success){c.value=s.error.errors[0].message;return}y.push({name:"email-verification",query:{e:btoa(a.value.user.email),ev:btoa(m.value),i:a.value.user.id}})},z={UNVERIFIED:"danger",PENDING:"warn",VERIFIED:"success"},x=async k=>{await U(()=>{var s;return Promise.resolve({success:!0,message:"User updated successfully.",user:{account:{...(s=a.value)==null?void 0:s.user.account,...k}}})})};return(k,s)=>{const r=De,W=ye,H=L,w=Y,Q=ne,X=O,Z=B,J=Ke,P=Ve,ee=re,M=be("RouterLink"),se=we,te=ze,le=de,ae=ie;return u(),D(ae,{name:"user"},{default:d(()=>[e("div",Ge,[l(r),e("div",Oe,[t(N)?(u(),D(W,{key:0})):t(g)?(u(),V("div",We,[l(H,{error:t(g),"should-retry":"",onRetry:s[0]||(s[0]=p=>t(U)())},null,8,["error"])])):t(a)?(u(),V("div",He,[e("div",Qe,[l(P,{class:"bg-gradient-y text-white"},{header:d(()=>[e("div",Xe,[l(w,{onClick:s[1]||(s[1]=p=>{var A;return(A=i.value)==null?void 0:A.toggle(p)}),size:"small",label:"Edit",icon:"pi pi-user-edit",class:"border-white bg-white text-primary-500"}),l(Q,{ref_key:"menu",ref:i,model:S.value,popup:!0},null,8,["model"]),l(Z,{visible:E.value,"onUpdate:visible":s[3]||(s[3]=p=>E.value=p),header:"Change Email",modal:"",class:"w-80"},{default:d(()=>[e("div",null,[e("div",Ze,[s[8]||(s[8]=e("label",{for:"email",class:"text-mute font-medium text-sm"}," Enter your new email address ",-1)),s[9]||(s[9]=e("small",{class:"text-primary-500"},"You will be asked to verify this email address.",-1)),l(X,{modelValue:m.value,"onUpdate:modelValue":s[2]||(s[2]=p=>m.value=p),fluid:""},null,8,["modelValue"]),n.value||c.value?(u(),V("small",Je,f(c.value||"Your new email is the same as your current email."),1)):$("",!0)]),l(w,{onClick:C,disabled:!m.value||n.value,label:"Proceed",icon:"pi pi-arrow-right","icon-pos":"right",fluid:"",class:"mt-4"},null,8,["disabled"])])]),_:1},8,["visible"]),l(J,{visible:h.value,"onUpdate:visible":s[4]||(s[4]=p=>h.value=p),user:t(a).user,onUpdate:o},null,8,["visible","user"])])]),default:d(()=>[e("div",es,[t(a).user.image?(u(),V("div",ss,[e("img",{src:t(a).user.image,alt:t(a).user.name,class:"w-full h-full object-cover"},null,8,ts)])):(u(),D(t(R),{key:1,icon:"ic:baseline-account-circle",style:{"font-size":"120px"}})),e("div",null,[e("h1",ls,f(t(a).user.name),1),e("p",null,f(t(a).user.email),1)])])]),_:1}),l(P,{class:"grid gap-2",header:"Profile"},{default:d(()=>[e("div",as,[e("div",os,[s[10]||(s[10]=e("div",{class:"flex items-center"},[e("span",{class:"pi pi-phone text-mute p-1 rounded-full",style:{"font-size":"12px"}}),e("p",{class:"text-mute text-sm font-semibold"},"Phone Number")],-1)),e("p",is,f(t(a).user.phoneNumber||"----------"),1)]),e("div",ns,[s[11]||(s[11]=e("div",{class:"flex items-center"},[e("span",{class:"pi pi-map text-mute p-1 rounded-full",style:{"font-size":"12px"}}),e("p",{class:"text-mute text-sm font-semibold"},"Address")],-1)),e("p",rs,f(t(a).user.address||"----------"),1)]),e("div",us,[s[12]||(s[12]=e("div",{class:"flex items-center"},[e("span",{class:"pi pi-map-marker text-mute p-1 rounded-full",style:{"font-size":"12px"}}),e("p",{class:"text-mute text-sm font-semibold"},"Location")],-1)),e("p",ds,f(t(a).user.region||"_____")+", "+f(t(a).user.country||"_____"),1)]),l(ee),e("div",null,[l(M,{to:{name:"user-change-password"}},{default:d(()=>[l(w,{fluid:"",label:"Change Password",icon:"pi pi-key"})]),_:1})])])]),_:1})]),e("div",ms,[l(P,{header:"Wallet Balance"},{header:d(()=>[e("div",cs,[l(t(R),{icon:"ic:baseline-attach-money",style:{"font-size":"28px"},class:"bg-primary-500 text-white p-1 rounded-full aspect-square"}),s[13]||(s[13]=e("p",{class:"font-semibold"},"Wallet Balance",-1))])]),default:d(()=>[e("div",ps,[e("p",fs," $"+f(t(a).user.account.walletBalance.toLocaleString().split(".")[0]??"00"),1),e("p",vs," ."+f(t(a).user.account.walletBalance.toLocaleString().split(".")[1]??"00"),1)]),e("div",_s,[l(M,{to:{name:"user-deposit-currencies"}},{default:d(()=>[l(w,{size:"small",label:"Deposit",class:"bg-gradient-x"})]),_:1}),l(M,{to:{name:"user-withdrawal-initialize"}},{default:d(()=>[l(w,{severity:"secondary",size:"small",label:"Withdraw",class:"dark:bg-slate-800 dark:border-slate-800"})]),_:1})])]),_:1}),l(P,{header:"KYC Verification"},{default:d(()=>[e("div",gs,[s[14]||(s[14]=e("div",{class:"flex items-center"},[e("span",{class:"pi pi-user text-mute p-1 rounded-full",style:{"font-size":"12px"}}),e("p",{class:"text-mute text-sm font-semibold"},"KYC Verification Status")],-1)),e("div",ys,[l(se,{severity:z[t(a).user.account.kycStatus],value:t(ue)(t(a).user.account.kycStatus)},null,8,["severity","value"]),t(a).user.account.kycStatus==="UNVERIFIED"?(u(),D(w,{key:0,onClick:s[5]||(s[5]=p=>b.value=!0),size:"small",class:"text-sm py-1",label:"Start Verification"})):$("",!0),l(te,{"account-id":t(a).user.account.id,visible:b.value,"onUpdate:visible":s[6]||(s[6]=p=>b.value=p),onUpdate:x},null,8,["account-id","visible"])])]),t(a).user.account.kycStatus!=="UNVERIFIED"?(u(),V("div",bs,[e("div",xs,[s[17]||(s[17]=e("div",{class:"flex items-center"},[e("span",{class:"pi pi-user text-mute p-1 rounded-full",style:{"font-size":"12px"}}),e("p",{class:"text-mute text-sm font-semibold"},"KYC Document")],-1)),e("div",ks,[e("div",hs,[s[15]||(s[15]=e("p",null,"ID Type",-1)),e("p",null,f(t(a).user.account.kycIdType),1)]),t(a).user.account.kycVerifiedAt?(u(),V("div",ws,[s[16]||(s[16]=e("p",null,"Verified On",-1)),e("p",null,f(t(xe)(t(a).user.account.kycVerifiedAt,"ddd, MMM DD, YYYY")),1)])):$("",!0),e("div",Vs,[l(w,{onClick:s[7]||(s[7]=p=>b.value=!0),label:"Update",icon:"pi pi-file-edit",size:"small"}),e("a",{href:t(a).user.account.kycDocument||"",download:`${t(a).user.account.id}.${t(a).user.account.kycDocumentExt}`},[l(w,{label:"Download",icon:"pi pi-download",size:"small",outlined:""})],8,$s)])])])])):$("",!0)]),_:1}),l(P,{header:"Log Out"},{default:d(()=>[l(le,null,{default:d(()=>[l(w,{fluid:"",label:"Log out",outlined:"",icon:"pi pi-sign-out outlined",severity:"danger"})]),_:1})]),_:1})])])):$("",!0)])])]),_:1})}}});export{Ys as default};
